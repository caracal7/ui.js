function Yt(r){let t=r[0],e=r[1],i=r[2];return Math.sqrt(t*t+e*e+i*i)}function Lt(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function hr(r,t,e,i){return r[0]=t,r[1]=e,r[2]=i,r}function Ht(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Qt(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function lr(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function cr(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function St(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function fr(r,t){let e=t[0]-r[0],i=t[1]-r[1],s=t[2]-r[2];return Math.sqrt(e*e+i*i+s*s)}function ur(r,t){let e=t[0]-r[0],i=t[1]-r[1],s=t[2]-r[2];return e*e+i*i+s*s}function Kt(r){let t=r[0],e=r[1],i=r[2];return t*t+e*e+i*i}function pr(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function dr(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function zt(r,t){let e=t[0],i=t[1],s=t[2],n=e*e+i*i+s*s;return n>0&&(n=1/Math.sqrt(n)),r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r}function Zt(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function $t(r,t,e){let i=t[0],s=t[1],n=t[2],a=e[0],o=e[1],h=e[2];return r[0]=s*h-n*o,r[1]=n*a-i*h,r[2]=i*o-s*a,r}function Pt(r,t,e,i){let s=t[0],n=t[1],a=t[2];return r[0]=s+i*(e[0]-s),r[1]=n+i*(e[1]-n),r[2]=a+i*(e[2]-a),r}function mr(r,t,e){let i=t[0],s=t[1],n=t[2],a=e[3]*i+e[7]*s+e[11]*n+e[15];return a=a||1,r[0]=(e[0]*i+e[4]*s+e[8]*n+e[12])/a,r[1]=(e[1]*i+e[5]*s+e[9]*n+e[13])/a,r[2]=(e[2]*i+e[6]*s+e[10]*n+e[14])/a,r}function gr(r,t,e){let i=t[0],s=t[1],n=t[2],a=e[3]*i+e[7]*s+e[11]*n+e[15];return a=a||1,r[0]=(e[0]*i+e[4]*s+e[8]*n)/a,r[1]=(e[1]*i+e[5]*s+e[9]*n)/a,r[2]=(e[2]*i+e[6]*s+e[10]*n)/a,r}function xr(r,t,e){let i=t[0],s=t[1],n=t[2];return r[0]=i*e[0]+s*e[3]+n*e[6],r[1]=i*e[1]+s*e[4]+n*e[7],r[2]=i*e[2]+s*e[5]+n*e[8],r}function yr(r,t,e){let i=t[0],s=t[1],n=t[2],a=e[0],o=e[1],h=e[2],l=e[3],c=o*n-h*s,f=h*i-a*n,u=a*s-o*i,p=o*u-h*f,d=h*c-a*u,x=a*f-o*c,m=l*2;return c*=m,f*=m,u*=m,p*=2,d*=2,x*=2,r[0]=i+c+p,r[1]=s+f+d,r[2]=n+u+x,r}var wr=function(){let r=[0,0,0],t=[0,0,0];return function(e,i){Lt(r,e),Lt(t,i),zt(r,r),zt(t,t);let s=Zt(r,t);return s>1?0:s<-1?Math.PI:Math.acos(s)}}();function Mr(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}var M=class r extends Array{constructor(t=0,e=t,i=t){return super(t,e,i),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,i=t){return t.length?this.copy(t):(hr(this,t,e,i),this)}copy(t){return Lt(this,t),this}add(t,e){return e?Ht(this,t,e):Ht(this,this,t),this}sub(t,e){return e?Qt(this,t,e):Qt(this,this,t),this}multiply(t){return t.length?lr(this,this,t):St(this,this,t),this}divide(t){return t.length?cr(this,this,t):St(this,this,1/t),this}inverse(t=this){return dr(this,t),this}len(){return Yt(this)}distance(t){return t?fr(this,t):Yt(this)}squaredLen(){return Kt(this)}squaredDistance(t){return t?ur(this,t):Kt(this)}negate(t=this){return pr(this,t),this}cross(t,e){return e?$t(this,t,e):$t(this,this,t),this}scale(t){return St(this,this,t),this}normalize(){return zt(this,this),this}dot(t){return Zt(this,t)}equals(t){return Mr(this,t)}applyMatrix3(t){return xr(this,this,t),this}applyMatrix4(t){return mr(this,this,t),this}scaleRotateMatrix4(t){return gr(this,this,t),this}applyQuaternion(t){return yr(this,this,t),this}angle(t){return wr(this,t)}lerp(t,e){return Pt(this,this,t,e),this}clone(){return new r(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){let e=this[0],i=this[1],s=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*s,this[1]=t[1]*e+t[5]*i+t[9]*s,this[2]=t[2]*e+t[6]*i+t[10]*s,this.normalize()}};var Er=new M,os=1,hs=1,Ar=!1,O=class{constructor(t,e={}){t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=e,this.id=os++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let i in e)this.addAttribute(i,e[i])}addAttribute(t,e){if(this.attributes[t]=e,e.id=hs++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target=t==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.usage=e.usage||this.gl.STATIC_DRAW,e.buffer||this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else t==="index"?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){let e=!t.buffer;e&&(t.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),e?this.gl.bufferData(t.target,t.data,t.usage):this.gl.bufferSubData(t.target,0,t.data),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((e,{name:i,type:s})=>{if(!this.attributes[i]){console.warn("active attribute ".concat(i," not being supplied"));return}let n=this.attributes[i];this.gl.bindBuffer(n.target,n.buffer),this.glState.boundBuffer=n.buffer;let a=1;s===35674&&(a=2),s===35675&&(a=3),s===35676&&(a=4);let o=n.size/a,h=a===1?0:a*a*4,l=a===1?0:a*4;for(let c=0;c<a;c++)this.gl.vertexAttribPointer(e+c,o,n.type,n.normalized,n.stride+h,n.offset+c*l),this.gl.enableVertexAttribArray(e+c),this.gl.renderer.vertexAttribDivisor(e+c,n.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){var s;this.gl.renderer.currentGeometry!=="".concat(this.id,"_").concat(t.attributeOrder)&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry="".concat(this.id,"_").concat(t.attributeOrder)),t.attributeLocations.forEach((n,{name:a})=>{let o=this.attributes[a];o.needsUpdate&&this.updateAttribute(o)});let i=2;((s=this.attributes.index)==null?void 0:s.type)===this.gl.UNSIGNED_INT&&(i=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*i,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*i):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){let t=this.attributes.position;if(t.data)return t;if(!Ar)return console.warn("No position buffer data found to compute bounds"),Ar=!0}computeBoundingBox(t){t||(t=this.getPosition());let e=t.data,i=t.size;this.bounds||(this.bounds={min:new M,max:new M,center:new M,scale:new M,radius:1/0});let s=this.bounds.min,n=this.bounds.max,a=this.bounds.center,o=this.bounds.scale;s.set(1/0),n.set(-1/0);for(let h=0,l=e.length;h<l;h+=i){let c=e[h],f=e[h+1],u=e[h+2];s.x=Math.min(c,s.x),s.y=Math.min(f,s.y),s.z=Math.min(u,s.z),n.x=Math.max(c,n.x),n.y=Math.max(f,n.y),n.z=Math.max(u,n.z)}o.sub(n,s),a.add(s,n).divide(2)}computeBoundingSphere(t){t||(t=this.getPosition());let e=t.data,i=t.size;this.bounds||this.computeBoundingBox(t);let s=0;for(let n=0,a=e.length;n<a;n+=i)Er.fromArray(e,n),s=Math.max(s,this.bounds.center.squaredDistance(Er));this.bounds.radius=Math.sqrt(s)}remove(){for(let t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}};var ls=1,vr={},U=class{constructor(t,{vertex:e,fragment:i,uniforms:s={},transparent:n=!1,cullFace:a=t.BACK,frontFace:o=t.CCW,depthTest:h=!0,depthWrite:l=!0,depthFunc:c=t.LESS}={}){t.canvas||console.error("gl not passed as first argument to Program"),this.gl=t,this.uniforms=s,this.id=ls++,e||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=a,this.frontFace=o,this.depthTest=h,this.depthWrite=l,this.depthFunc=c,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));let f=t.createShader(t.VERTEX_SHADER);t.shaderSource(f,e),t.compileShader(f),t.getShaderInfoLog(f)!==""&&console.warn("".concat(t.getShaderInfoLog(f),"\nVertex Shader\n").concat(br(e)));let u=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(u,i),t.compileShader(u),t.getShaderInfoLog(u)!==""&&console.warn("".concat(t.getShaderInfoLog(u),"\nFragment Shader\n").concat(br(i))),this.program=t.createProgram(),t.attachShader(this.program,f),t.attachShader(this.program,u),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(f),t.deleteShader(u),this.uniformLocations=new Map;let p=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let m=0;m<p;m++){let g=t.getActiveUniform(this.program,m);this.uniformLocations.set(g,t.getUniformLocation(this.program,g.name));let w=g.name.match(/(\w+)/g);g.uniformName=w[0],g.nameComponents=w.slice(1)}this.attributeLocations=new Map;let d=[],x=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let m=0;m<x;m++){let g=t.getActiveAttrib(this.program,m),w=t.getAttribLocation(this.program,g.name);w!==-1&&(d[w]=g.name,this.attributeLocations.set(g,w))}this.attributeOrder=d.join("")}setBlendFunc(t,e,i,s){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=s,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((s,n)=>{let a=this.uniforms[n.uniformName];for(let o of n.nameComponents){if(!a)break;if(o in a)a=a[o];else{if(Array.isArray(a.value))break;a=void 0;break}}if(!a)return Fr("Active uniform ".concat(n.name," has not been supplied"));if(a&&a.value===void 0)return Fr("".concat(n.name," uniform is missing a value parameter"));if(a.value.texture)return e=e+1,a.value.update(e),Jt(this.gl,n.type,s,e);if(a.value.length&&a.value[0].texture){let o=[];return a.value.forEach(h=>{e=e+1,h.update(e),o.push(e)}),Jt(this.gl,n.type,s,o)}Jt(this.gl,n.type,s,a.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}};function Jt(r,t,e,i){i=i.length?cs(i):i;let s=r.renderer.state.uniformLocations.get(e);if(i.length)if(s===void 0||s.length!==i.length)r.renderer.state.uniformLocations.set(e,i.slice(0));else{if(fs(s,i))return;s.set?s.set(i):us(s,i),r.renderer.state.uniformLocations.set(e,s)}else{if(s===i)return;r.renderer.state.uniformLocations.set(e,i)}switch(t){case 5126:return i.length?r.uniform1fv(e,i):r.uniform1f(e,i);case 35664:return r.uniform2fv(e,i);case 35665:return r.uniform3fv(e,i);case 35666:return r.uniform4fv(e,i);case 35670:case 5124:case 35678:case 35680:return i.length?r.uniform1iv(e,i):r.uniform1i(e,i);case 35671:case 35667:return r.uniform2iv(e,i);case 35672:case 35668:return r.uniform3iv(e,i);case 35673:case 35669:return r.uniform4iv(e,i);case 35674:return r.uniformMatrix2fv(e,!1,i);case 35675:return r.uniformMatrix3fv(e,!1,i);case 35676:return r.uniformMatrix4fv(e,!1,i)}}function br(r){let t=r.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}function cs(r){let t=r.length,e=r[0].length;if(e===void 0)return r;let i=t*e,s=vr[i];s||(vr[i]=s=new Float32Array(i));for(let n=0;n<t;n++)s.set(r[n],n*e);return s}function fs(r,t){if(r.length!==t.length)return!1;for(let e=0,i=r.length;e<i;e++)if(r[e]!==t[e])return!1;return!0}function us(r,t){for(let e=0,i=r.length;e<i;e++)r[e]=t[e]}var te=0;function Fr(r){te>100||(console.warn(r),te++,te>100&&console.warn("More than 100 program warnings - stopping logs."))}var ee=new M,ps=1,re=class{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:s=1,alpha:n=!1,depth:a=!0,stencil:o=!1,antialias:h=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:c=!1,powerPreference:f="default",autoClear:u=!0,webgl:p=2}={}){let d={alpha:n,depth:a,stencil:o,antialias:h,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:f};this.dpr=s,this.alpha=n,this.color=!0,this.depth=a,this.stencil=o,this.premultipliedAlpha=l,this.autoClear=u,this.id=ps++,p===2&&(this.gl=t.getContext("webgl2",d)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",d)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,i),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e,i=0,s=0){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.state.viewport.x=i,this.state.viewport.y=s,this.gl.viewport(i,s,t,e))}setScissor(t,e,i=0,s=0){this.gl.scissor(i,s,t,e)}enable(t){this.state[t]!==!0&&(this.gl.enable(t),this.state[t]=!0)}disable(t){this.state[t]!==!1&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,i,s){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===s||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=s,i!==void 0?this.gl.blendFuncSeparate(t,e,i,s):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e)&&(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,e!==void 0?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:i,sort:s}){let n=[];if(e&&i&&e.updateFrustum(),t.traverse(a=>{if(!a.visible)return!0;a.draw&&(i&&a.frustumCulled&&e&&!e.frustumIntersectsMesh(a)||n.push(a))}),s){let a=[],o=[],h=[];n.forEach(l=>{l.program.transparent?l.program.depthTest?o.push(l):h.push(l):a.push(l),l.zDepth=0,!(l.renderOrder!==0||!l.program.depthTest||!e)&&(l.worldMatrix.getTranslation(ee),ee.applyMatrix4(e.projectionViewMatrix),l.zDepth=ee.z)}),a.sort(this.sortOpaque),o.sort(this.sortTransparent),h.sort(this.sortUI),n=a.concat(o,h)}return n}render({scene:t,camera:e,target:i=null,update:s=!0,sort:n=!0,frustumCull:a=!0,clear:o}){i===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(i),this.setViewport(i.width,i.height)),(o||this.autoClear&&o!==!1)&&(this.depth&&(!i||i.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:a,sort:n}).forEach(l=>{l.draw({camera:e})})}};function Ct(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Nt(r,t,e,i,s){return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r}function ie(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r}function It(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=e*e+i*i+s*s+n*n;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=i*a,r[2]=s*a,r[3]=n*a,r}function Ot(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function _r(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Rr(r,t,e){e=e*.5;let i=Math.sin(e);return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=Math.cos(e),r}function se(r,t,e){let i=t[0],s=t[1],n=t[2],a=t[3],o=e[0],h=e[1],l=e[2],c=e[3];return r[0]=i*c+a*o+s*l-n*h,r[1]=s*c+a*h+n*o-i*l,r[2]=n*c+a*l+i*h-s*o,r[3]=a*c-i*o-s*h-n*l,r}function Lr(r,t,e){e*=.5;let i=t[0],s=t[1],n=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=i*h+a*o,r[1]=s*h+n*o,r[2]=n*h-s*o,r[3]=a*h-i*o,r}function zr(r,t,e){e*=.5;let i=t[0],s=t[1],n=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=i*h-n*o,r[1]=s*h+a*o,r[2]=n*h+i*o,r[3]=a*h-s*o,r}function Sr(r,t,e){e*=.5;let i=t[0],s=t[1],n=t[2],a=t[3],o=Math.sin(e),h=Math.cos(e);return r[0]=i*h+s*o,r[1]=s*h-i*o,r[2]=n*h+a*o,r[3]=a*h-n*o,r}function Pr(r,t,e,i){let s=t[0],n=t[1],a=t[2],o=t[3],h=e[0],l=e[1],c=e[2],f=e[3],u,p,d,x,m;return p=s*h+n*l+a*c+o*f,p<0&&(p=-p,h=-h,l=-l,c=-c,f=-f),1-p>1e-6?(u=Math.acos(p),d=Math.sin(u),x=Math.sin((1-i)*u)/d,m=Math.sin(i*u)/d):(x=1-i,m=i),r[0]=x*s+m*h,r[1]=x*n+m*l,r[2]=x*a+m*c,r[3]=x*o+m*f,r}function Cr(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=e*e+i*i+s*s+n*n,o=a?1/a:0;return r[0]=-e*o,r[1]=-i*o,r[2]=-s*o,r[3]=n*o,r}function Nr(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r}function Ir(r,t){let e=t[0]+t[4]+t[8],i;if(e>0)i=Math.sqrt(e+1),r[3]=.5*i,i=.5/i,r[0]=(t[5]-t[7])*i,r[1]=(t[6]-t[2])*i,r[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);let n=(s+1)%3,a=(s+2)%3;i=Math.sqrt(t[s*3+s]-t[n*3+n]-t[a*3+a]+1),r[s]=.5*i,i=.5/i,r[3]=(t[n*3+a]-t[a*3+n])*i,r[n]=(t[n*3+s]+t[s*3+n])*i,r[a]=(t[a*3+s]+t[s*3+a])*i}return r}function Or(r,t,e="YXZ"){let i=Math.sin(t[0]*.5),s=Math.cos(t[0]*.5),n=Math.sin(t[1]*.5),a=Math.cos(t[1]*.5),o=Math.sin(t[2]*.5),h=Math.cos(t[2]*.5);return e==="XYZ"?(r[0]=i*a*h+s*n*o,r[1]=s*n*h-i*a*o,r[2]=s*a*o+i*n*h,r[3]=s*a*h-i*n*o):e==="YXZ"?(r[0]=i*a*h+s*n*o,r[1]=s*n*h-i*a*o,r[2]=s*a*o-i*n*h,r[3]=s*a*h+i*n*o):e==="ZXY"?(r[0]=i*a*h-s*n*o,r[1]=s*n*h+i*a*o,r[2]=s*a*o+i*n*h,r[3]=s*a*h-i*n*o):e==="ZYX"?(r[0]=i*a*h-s*n*o,r[1]=s*n*h+i*a*o,r[2]=s*a*o-i*n*h,r[3]=s*a*h+i*n*o):e==="YZX"?(r[0]=i*a*h+s*n*o,r[1]=s*n*h+i*a*o,r[2]=s*a*o-i*n*h,r[3]=s*a*h-i*n*o):e==="XZY"&&(r[0]=i*a*h-s*n*o,r[1]=s*n*h-i*a*o,r[2]=s*a*o+i*n*h,r[3]=s*a*h+i*n*o),r}var Br=Ct,Vr=Nt;var Dr=Ot;var Ur=It;var K=class extends Array{constructor(t=0,e=0,i=0,s=1){return super(t,e,i,s),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){return _r(this),this.onChange(),this}set(t,e,i,s){return t.length?this.copy(t):(Vr(this,t,e,i,s),this.onChange(),this)}rotateX(t){return Lr(this,this,t),this.onChange(),this}rotateY(t){return zr(this,this,t),this.onChange(),this}rotateZ(t){return Sr(this,this,t),this.onChange(),this}inverse(t=this){return Cr(this,t),this.onChange(),this}conjugate(t=this){return Nr(this,t),this.onChange(),this}copy(t){return Br(this,t),this.onChange(),this}normalize(t=this){return Ur(this,t),this.onChange(),this}multiply(t,e){return e?se(this,t,e):se(this,this,t),this.onChange(),this}dot(t){return Dr(this,t)}fromMatrix3(t){return Ir(this,t),this.onChange(),this}fromEuler(t){return Or(this,t,t.order),this}fromAxisAngle(t,e){return Rr(this,t,e),this.onChange(),this}slerp(t,e){return Pr(this,this,t,e),this.onChange(),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this.onChange(),this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}};function Gr(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function kr(r,t,e,i,s,n,a,o,h,l,c,f,u,p,d,x,m){return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r[4]=n,r[5]=a,r[6]=o,r[7]=h,r[8]=l,r[9]=c,r[10]=f,r[11]=u,r[12]=p,r[13]=d,r[14]=x,r[15]=m,r}function qr(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Wr(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=t[9],u=t[10],p=t[11],d=t[12],x=t[13],m=t[14],g=t[15],w=e*o-i*a,y=e*h-s*a,b=e*l-n*a,A=i*h-s*o,E=i*l-n*o,T=s*l-n*h,v=c*x-f*d,R=c*m-u*d,z=c*g-p*d,P=f*m-u*x,_=f*g-p*x,S=u*g-p*m,F=w*S-y*_+b*P+A*z-E*R+T*v;return F?(F=1/F,r[0]=(o*S-h*_+l*P)*F,r[1]=(s*_-i*S-n*P)*F,r[2]=(x*T-m*E+g*A)*F,r[3]=(u*E-f*T-p*A)*F,r[4]=(h*z-a*S-l*R)*F,r[5]=(e*S-s*z+n*R)*F,r[6]=(m*b-d*T-g*y)*F,r[7]=(c*T-u*b+p*y)*F,r[8]=(a*_-o*z+l*v)*F,r[9]=(i*z-e*_-n*v)*F,r[10]=(d*E-x*b+g*w)*F,r[11]=(f*b-c*E-p*w)*F,r[12]=(o*R-a*P-h*v)*F,r[13]=(e*P-i*R+s*v)*F,r[14]=(x*y-d*A-m*w)*F,r[15]=(c*A-f*y+u*w)*F,r):null}function jr(r){let t=r[0],e=r[1],i=r[2],s=r[3],n=r[4],a=r[5],o=r[6],h=r[7],l=r[8],c=r[9],f=r[10],u=r[11],p=r[12],d=r[13],x=r[14],m=r[15],g=t*a-e*n,w=t*o-i*n,y=t*h-s*n,b=e*o-i*a,A=e*h-s*a,E=i*h-s*o,T=l*d-c*p,v=l*x-f*p,R=l*m-u*p,z=c*x-f*d,P=c*m-u*d,_=f*m-u*x;return g*_-w*P+y*z+b*R-A*v+E*T}function ne(r,t,e){let i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=t[9],p=t[10],d=t[11],x=t[12],m=t[13],g=t[14],w=t[15],y=e[0],b=e[1],A=e[2],E=e[3];return r[0]=y*i+b*o+A*f+E*x,r[1]=y*s+b*h+A*u+E*m,r[2]=y*n+b*l+A*p+E*g,r[3]=y*a+b*c+A*d+E*w,y=e[4],b=e[5],A=e[6],E=e[7],r[4]=y*i+b*o+A*f+E*x,r[5]=y*s+b*h+A*u+E*m,r[6]=y*n+b*l+A*p+E*g,r[7]=y*a+b*c+A*d+E*w,y=e[8],b=e[9],A=e[10],E=e[11],r[8]=y*i+b*o+A*f+E*x,r[9]=y*s+b*h+A*u+E*m,r[10]=y*n+b*l+A*p+E*g,r[11]=y*a+b*c+A*d+E*w,y=e[12],b=e[13],A=e[14],E=e[15],r[12]=y*i+b*o+A*f+E*x,r[13]=y*s+b*h+A*u+E*m,r[14]=y*n+b*l+A*p+E*g,r[15]=y*a+b*c+A*d+E*w,r}function Xr(r,t,e){let i=e[0],s=e[1],n=e[2],a,o,h,l,c,f,u,p,d,x,m,g;return t===r?(r[12]=t[0]*i+t[4]*s+t[8]*n+t[12],r[13]=t[1]*i+t[5]*s+t[9]*n+t[13],r[14]=t[2]*i+t[6]*s+t[10]*n+t[14],r[15]=t[3]*i+t[7]*s+t[11]*n+t[15]):(a=t[0],o=t[1],h=t[2],l=t[3],c=t[4],f=t[5],u=t[6],p=t[7],d=t[8],x=t[9],m=t[10],g=t[11],r[0]=a,r[1]=o,r[2]=h,r[3]=l,r[4]=c,r[5]=f,r[6]=u,r[7]=p,r[8]=d,r[9]=x,r[10]=m,r[11]=g,r[12]=a*i+c*s+d*n+t[12],r[13]=o*i+f*s+x*n+t[13],r[14]=h*i+u*s+m*n+t[14],r[15]=l*i+p*s+g*n+t[15]),r}function Yr(r,t,e){let i=e[0],s=e[1],n=e[2];return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*s,r[5]=t[5]*s,r[6]=t[6]*s,r[7]=t[7]*s,r[8]=t[8]*n,r[9]=t[9]*n,r[10]=t[10]*n,r[11]=t[11]*n,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Hr(r,t,e,i){let s=i[0],n=i[1],a=i[2],o=Math.hypot(s,n,a),h,l,c,f,u,p,d,x,m,g,w,y,b,A,E,T,v,R,z,P,_,S,F,C;return Math.abs(o)<1e-6?null:(o=1/o,s*=o,n*=o,a*=o,h=Math.sin(e),l=Math.cos(e),c=1-l,f=t[0],u=t[1],p=t[2],d=t[3],x=t[4],m=t[5],g=t[6],w=t[7],y=t[8],b=t[9],A=t[10],E=t[11],T=s*s*c+l,v=n*s*c+a*h,R=a*s*c-n*h,z=s*n*c-a*h,P=n*n*c+l,_=a*n*c+s*h,S=s*a*c+n*h,F=n*a*c-s*h,C=a*a*c+l,r[0]=f*T+x*v+y*R,r[1]=u*T+m*v+b*R,r[2]=p*T+g*v+A*R,r[3]=d*T+w*v+E*R,r[4]=f*z+x*P+y*_,r[5]=u*z+m*P+b*_,r[6]=p*z+g*P+A*_,r[7]=d*z+w*P+E*_,r[8]=f*S+x*F+y*C,r[9]=u*S+m*F+b*C,r[10]=p*S+g*F+A*C,r[11]=d*S+w*F+E*C,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function Qr(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function ae(r,t){let e=t[0],i=t[1],s=t[2],n=t[4],a=t[5],o=t[6],h=t[8],l=t[9],c=t[10];return r[0]=Math.hypot(e,i,s),r[1]=Math.hypot(n,a,o),r[2]=Math.hypot(h,l,c),r}function Kr(r){let t=r[0],e=r[1],i=r[2],s=r[4],n=r[5],a=r[6],o=r[8],h=r[9],l=r[10],c=t*t+e*e+i*i,f=s*s+n*n+a*a,u=o*o+h*h+l*l;return Math.sqrt(Math.max(c,f,u))}var Zr=function(){let r=[1,1,1];return function(t,e){let i=r;ae(i,e);let s=1/i[0],n=1/i[1],a=1/i[2],o=e[0]*s,h=e[1]*n,l=e[2]*a,c=e[4]*s,f=e[5]*n,u=e[6]*a,p=e[8]*s,d=e[9]*n,x=e[10]*a,m=o+f+x,g=0;return m>0?(g=Math.sqrt(m+1)*2,t[3]=.25*g,t[0]=(u-d)/g,t[1]=(p-l)/g,t[2]=(h-c)/g):o>f&&o>x?(g=Math.sqrt(1+o-f-x)*2,t[3]=(u-d)/g,t[0]=.25*g,t[1]=(h+c)/g,t[2]=(p+l)/g):f>x?(g=Math.sqrt(1+f-o-x)*2,t[3]=(p-l)/g,t[0]=(h+c)/g,t[1]=.25*g,t[2]=(u+d)/g):(g=Math.sqrt(1+x-o-f)*2,t[3]=(h-c)/g,t[0]=(p+l)/g,t[1]=(u+d)/g,t[2]=.25*g),t}}();function $r(r,t,e,i){let s=t[0],n=t[1],a=t[2],o=t[3],h=s+s,l=n+n,c=a+a,f=s*h,u=s*l,p=s*c,d=n*l,x=n*c,m=a*c,g=o*h,w=o*l,y=o*c,b=i[0],A=i[1],E=i[2];return r[0]=(1-(d+m))*b,r[1]=(u+y)*b,r[2]=(p-w)*b,r[3]=0,r[4]=(u-y)*A,r[5]=(1-(f+m))*A,r[6]=(x+g)*A,r[7]=0,r[8]=(p+w)*E,r[9]=(x-g)*E,r[10]=(1-(f+d))*E,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function Jr(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=e+e,o=i+i,h=s+s,l=e*a,c=i*a,f=i*o,u=s*a,p=s*o,d=s*h,x=n*a,m=n*o,g=n*h;return r[0]=1-f-d,r[1]=c+g,r[2]=u-m,r[3]=0,r[4]=c-g,r[5]=1-l-d,r[6]=p+x,r[7]=0,r[8]=u+m,r[9]=p-x,r[10]=1-l-f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ti(r,t,e,i,s){let n=1/Math.tan(t/2),a=1/(i-s);return r[0]=n/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(s+i)*a,r[11]=-1,r[12]=0,r[13]=0,r[14]=2*s*i*a,r[15]=0,r}function ei(r,t,e,i,s,n,a){let o=1/(t-e),h=1/(i-s),l=1/(n-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*l,r[11]=0,r[12]=(t+e)*o,r[13]=(s+i)*h,r[14]=(a+n)*l,r[15]=1,r}function ri(r,t,e,i){let s=t[0],n=t[1],a=t[2],o=i[0],h=i[1],l=i[2],c=s-e[0],f=n-e[1],u=a-e[2],p=c*c+f*f+u*u;p===0?u=1:(p=1/Math.sqrt(p),c*=p,f*=p,u*=p);let d=h*u-l*f,x=l*c-o*u,m=o*f-h*c;return p=d*d+x*x+m*m,p===0&&(l?o+=1e-6:h?l+=1e-6:h+=1e-6,d=h*u-l*f,x=l*c-o*u,m=o*f-h*c,p=d*d+x*x+m*m),p=1/Math.sqrt(p),d*=p,x*=p,m*=p,r[0]=d,r[1]=x,r[2]=m,r[3]=0,r[4]=f*m-u*x,r[5]=u*d-c*m,r[6]=c*x-f*d,r[7]=0,r[8]=c,r[9]=f,r[10]=u,r[11]=0,r[12]=s,r[13]=n,r[14]=a,r[15]=1,r}function oe(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r[8]=t[8]+e[8],r[9]=t[9]+e[9],r[10]=t[10]+e[10],r[11]=t[11]+e[11],r[12]=t[12]+e[12],r[13]=t[13]+e[13],r[14]=t[14]+e[14],r[15]=t[15]+e[15],r}function he(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r[6]=t[6]-e[6],r[7]=t[7]-e[7],r[8]=t[8]-e[8],r[9]=t[9]-e[9],r[10]=t[10]-e[10],r[11]=t[11]-e[11],r[12]=t[12]-e[12],r[13]=t[13]-e[13],r[14]=t[14]-e[14],r[15]=t[15]-e[15],r}function ii(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*e,r[9]=t[9]*e,r[10]=t[10]*e,r[11]=t[11]*e,r[12]=t[12]*e,r[13]=t[13]*e,r[14]=t[14]*e,r[15]=t[15]*e,r}var D=class extends Array{constructor(t=1,e=0,i=0,s=0,n=0,a=1,o=0,h=0,l=0,c=0,f=1,u=0,p=0,d=0,x=0,m=1){return super(t,e,i,s,n,a,o,h,l,c,f,u,p,d,x,m),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,i,s,n,a,o,h,l,c,f,u,p,d,x,m){return t.length?this.copy(t):(kr(this,t,e,i,s,n,a,o,h,l,c,f,u,p,d,x,m),this)}translate(t,e=this){return Xr(this,e,t),this}rotate(t,e,i=this){return Hr(this,i,t,e),this}scale(t,e=this){return Yr(this,e,typeof t=="number"?[t,t,t]:t),this}add(t,e){return e?oe(this,t,e):oe(this,this,t),this}sub(t,e){return e?he(this,t,e):he(this,this,t),this}multiply(t,e){return t.length?e?ne(this,t,e):ne(this,this,t):ii(this,this,t),this}identity(){return qr(this),this}copy(t){return Gr(this,t),this}fromPerspective({fov:t,aspect:e,near:i,far:s}={}){return ti(this,t,e,i,s),this}fromOrthogonal({left:t,right:e,bottom:i,top:s,near:n,far:a}){return ei(this,t,e,i,s,n,a),this}fromQuaternion(t){return Jr(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return Wr(this,t),this}compose(t,e,i){return $r(this,t,e,i),this}getRotation(t){return Zr(t,this),this}getTranslation(t){return Qr(t,this),this}getScaling(t){return ae(t,this),this}getMaxScaleOnAxis(){return Kr(this)}lookAt(t,e,i){return ri(this,t,e,i),this}determinant(){return jr(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}};function si(r,t,e="YXZ"){return e==="XYZ"?(r[1]=Math.asin(Math.min(Math.max(t[8],-1),1)),Math.abs(t[8])<.99999?(r[0]=Math.atan2(-t[9],t[10]),r[2]=Math.atan2(-t[4],t[0])):(r[0]=Math.atan2(t[6],t[5]),r[2]=0)):e==="YXZ"?(r[0]=Math.asin(-Math.min(Math.max(t[9],-1),1)),Math.abs(t[9])<.99999?(r[1]=Math.atan2(t[8],t[10]),r[2]=Math.atan2(t[1],t[5])):(r[1]=Math.atan2(-t[2],t[0]),r[2]=0)):e==="ZXY"?(r[0]=Math.asin(Math.min(Math.max(t[6],-1),1)),Math.abs(t[6])<.99999?(r[1]=Math.atan2(-t[2],t[10]),r[2]=Math.atan2(-t[4],t[5])):(r[1]=0,r[2]=Math.atan2(t[1],t[0]))):e==="ZYX"?(r[1]=Math.asin(-Math.min(Math.max(t[2],-1),1)),Math.abs(t[2])<.99999?(r[0]=Math.atan2(t[6],t[10]),r[2]=Math.atan2(t[1],t[0])):(r[0]=0,r[2]=Math.atan2(-t[4],t[5]))):e==="YZX"?(r[2]=Math.asin(Math.min(Math.max(t[1],-1),1)),Math.abs(t[1])<.99999?(r[0]=Math.atan2(-t[9],t[5]),r[1]=Math.atan2(-t[2],t[0])):(r[0]=0,r[1]=Math.atan2(t[8],t[10]))):e==="XZY"&&(r[2]=Math.asin(-Math.min(Math.max(t[4],-1),1)),Math.abs(t[4])<.99999?(r[0]=Math.atan2(t[6],t[5]),r[1]=Math.atan2(t[8],t[0])):(r[0]=Math.atan2(-t[9],t[10]),r[1]=0)),r}var ni=new D,mt=class extends Array{constructor(t=0,e=t,i=t,s="YXZ"){return super(t,e,i),this.order=s,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,i=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return si(this,t,e),this.onChange(),this}fromQuaternion(t,e=this.order){return ni.fromQuaternion(t),this.fromRotationMatrix(ni,e)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}};var H=class{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new D,this.worldMatrix=new D,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new M,this.quaternion=new K,this.scale=new M(1),this.rotation=new mt,this.up=new M(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}};var xs=new D,ys=new M,ws=new M,gt=class extends H{constructor(t,{near:e=.1,far:i=100,fov:s=45,aspect:n=1,left:a,right:o,bottom:h,top:l,zoom:c=1}={}){super(),Object.assign(this,{near:e,far:i,fov:s,aspect:n,left:a,right:o,bottom:h,top:l,zoom:c}),this.projectionMatrix=new D,this.viewMatrix=new D,this.projectionViewMatrix=new D,this.worldPosition=new M,this.type=a||o?"orthographic":"perspective",this.type==="orthographic"?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:i=this.fov,aspect:s=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:i,aspect:s}),this.projectionMatrix.fromPerspective({fov:i*(Math.PI/180),aspect:s,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:i=this.left||-1,right:s=this.right||1,bottom:n=this.bottom||-1,top:a=this.top||1,zoom:o=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:i,right:s,bottom:n,top:a,zoom:o}),i/=o,s/=o,n/=o,a/=o,this.projectionMatrix.fromOrthogonal({left:i,right:s,bottom:n,top:a,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(xs.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new M,new M,new M,new M,new M,new M]);let t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let e=0;e<6;e++){let i=1/this.frustum[e].distance();this.frustum[e].multiply(i),this.frustum[e].constant*=i}}frustumIntersectsMesh(t,e=t.worldMatrix){if(!t.geometry.attributes.position||((!t.geometry.bounds||t.geometry.bounds.radius===1/0)&&t.geometry.computeBoundingSphere(),!t.geometry.bounds))return!0;let i=ys;i.copy(t.geometry.bounds.center),i.applyMatrix4(e);let s=t.geometry.bounds.radius*e.getMaxScaleOnAxis();return this.frustumIntersectsSphere(i,s)}frustumIntersectsSphere(t,e){let i=ws;for(let s=0;s<6;s++){let n=this.frustum[s];if(i.copy(n).dot(t)+n.constant<-e)return!1}return!0}};function ai(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r}function oi(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=e+e,o=i+i,h=s+s,l=e*a,c=i*a,f=i*o,u=s*a,p=s*o,d=s*h,x=n*a,m=n*o,g=n*h;return r[0]=1-f-d,r[3]=c-g,r[6]=u+m,r[1]=c+g,r[4]=1-l-d,r[7]=p-x,r[2]=u-m,r[5]=p+x,r[8]=1-l-f,r}function hi(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function li(r,t,e,i,s,n,a,o,h,l){return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r[4]=n,r[5]=a,r[6]=o,r[7]=h,r[8]=l,r}function ci(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function fi(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=c*a-o*l,u=-c*n+o*h,p=l*n-a*h,d=e*f+i*u+s*p;return d?(d=1/d,r[0]=f*d,r[1]=(-c*i+s*l)*d,r[2]=(o*i-s*a)*d,r[3]=u*d,r[4]=(c*e-s*h)*d,r[5]=(-o*e+s*n)*d,r[6]=p*d,r[7]=(-l*e+i*h)*d,r[8]=(a*e-i*n)*d,r):null}function le(r,t,e){let i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=e[0],p=e[1],d=e[2],x=e[3],m=e[4],g=e[5],w=e[6],y=e[7],b=e[8];return r[0]=u*i+p*a+d*l,r[1]=u*s+p*o+d*c,r[2]=u*n+p*h+d*f,r[3]=x*i+m*a+g*l,r[4]=x*s+m*o+g*c,r[5]=x*n+m*h+g*f,r[6]=w*i+y*a+b*l,r[7]=w*s+y*o+b*c,r[8]=w*n+y*h+b*f,r}function ui(r,t,e){let i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=e[0],p=e[1];return r[0]=i,r[1]=s,r[2]=n,r[3]=a,r[4]=o,r[5]=h,r[6]=u*i+p*a+l,r[7]=u*s+p*o+c,r[8]=u*n+p*h+f,r}function pi(r,t,e){let i=t[0],s=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],f=t[8],u=Math.sin(e),p=Math.cos(e);return r[0]=p*i+u*a,r[1]=p*s+u*o,r[2]=p*n+u*h,r[3]=p*a-u*i,r[4]=p*o-u*s,r[5]=p*h-u*n,r[6]=l,r[7]=c,r[8]=f,r}function di(r,t,e){let i=e[0],s=e[1];return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=s*t[3],r[4]=s*t[4],r[5]=s*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r}function mi(r,t){let e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],c=t[8],f=t[9],u=t[10],p=t[11],d=t[12],x=t[13],m=t[14],g=t[15],w=e*o-i*a,y=e*h-s*a,b=e*l-n*a,A=i*h-s*o,E=i*l-n*o,T=s*l-n*h,v=c*x-f*d,R=c*m-u*d,z=c*g-p*d,P=f*m-u*x,_=f*g-p*x,S=u*g-p*m,F=w*S-y*_+b*P+A*z-E*R+T*v;return F?(F=1/F,r[0]=(o*S-h*_+l*P)*F,r[1]=(h*z-a*S-l*R)*F,r[2]=(a*_-o*z+l*v)*F,r[3]=(s*_-i*S-n*P)*F,r[4]=(e*S-s*z+n*R)*F,r[5]=(i*z-e*_-n*v)*F,r[6]=(x*T-m*E+g*A)*F,r[7]=(m*b-d*T-g*y)*F,r[8]=(d*E-x*b+g*w)*F,r):null}var et=class extends Array{constructor(t=1,e=0,i=0,s=0,n=1,a=0,o=0,h=0,l=1){return super(t,e,i,s,n,a,o,h,l),this}set(t,e,i,s,n,a,o,h,l){return t.length?this.copy(t):(li(this,t,e,i,s,n,a,o,h,l),this)}translate(t,e=this){return ui(this,e,t),this}rotate(t,e=this){return pi(this,e,t),this}scale(t,e=this){return di(this,e,t),this}multiply(t,e){return e?le(this,t,e):le(this,this,t),this}identity(){return ci(this),this}copy(t){return hi(this,t),this}fromMatrix4(t){return ai(this,t),this}fromQuaternion(t){return oi(this,t),this}fromBasis(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}inverse(t=this){return fi(this,t),this}getNormalMatrix(t){return mi(this,t),this}};var Es=0,B=class extends H{constructor(t,{geometry:e,program:i,mode:s=t.TRIANGLES,frustumCulled:n=!0,renderOrder:a=0}={}){super(),t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=Es++,this.geometry=e,this.program=i,this.mode=s,this.frustumCulled=n,this.renderOrder=a,this.modelViewMatrix=new D,this.normalMatrix=new et,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(i=>i&&i({mesh:this,camera:t}));let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(i=>i&&i({mesh:this,camera:t}))}};var gi=new Uint8Array(4);function xi(r){return(r&r-1)===0}var As=1,q=class{constructor(t,{image:e,target:i=t.TEXTURE_2D,type:s=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:a=n,wrapS:o=t.CLAMP_TO_EDGE,wrapT:h=t.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:c=l?t.NEAREST_MIPMAP_LINEAR:t.LINEAR,magFilter:f=t.LINEAR,premultiplyAlpha:u=!1,unpackAlignment:p=4,flipY:d=i==t.TEXTURE_2D,anisotropy:x=0,level:m=0,width:g,height:w=g}={}){this.gl=t,this.id=As++,this.image=e,this.target=i,this.type=s,this.format=n,this.internalFormat=a,this.minFilter=c,this.magFilter=f,this.wrapS=o,this.wrapT=h,this.generateMipmaps=l,this.premultiplyAlpha=u,this.unpackAlignment=p,this.flipY=d,this.anisotropy=Math.min(x,this.gl.renderer.parameters.maxAnisotropy),this.level=m,this.width=g,this.height=w,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){let e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),!!e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let i=0;i<6;i++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.level,this.internalFormat,this.format,this.type,this.image[i]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let i=0;i<this.image.length;i++)this.gl.compressedTexImage2D(this.target,i,this.internalFormat,this.image[i].width,this.image[i].height,0,this.image[i].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!xi(this.image.width)||!xi(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let i=0;i<6;i++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,gi);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,gi);this.store.image=this.image}}};var Y=class{constructor(t,{width:e=t.canvas.width,height:i=t.canvas.height,target:s=t.FRAMEBUFFER,color:n=1,depth:a=!0,stencil:o=!1,depthTexture:h=!1,wrapS:l=t.CLAMP_TO_EDGE,wrapT:c=t.CLAMP_TO_EDGE,minFilter:f=t.LINEAR,magFilter:u=f,type:p=t.UNSIGNED_BYTE,format:d=t.RGBA,internalFormat:x=d,unpackAlignment:m,premultiplyAlpha:g}={}){this.gl=t,this.width=e,this.height=i,this.depth=a,this.buffer=this.gl.createFramebuffer(),this.target=s,this.gl.renderer.bindFramebuffer(this),this.textures=[];let w=[];for(let y=0;y<n;y++)this.textures.push(new q(t,{width:e,height:i,wrapS:l,wrapT:c,minFilter:f,magFilter:u,type:p,format:d,internalFormat:x,unpackAlignment:m,premultiplyAlpha:g,flipY:!1,generateMipmaps:!1})),this.textures[y].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+y,this.gl.TEXTURE_2D,this.textures[y].texture,0),w.push(this.gl.COLOR_ATTACHMENT0+y);w.length>1&&this.gl.renderer.drawBuffers(w),this.texture=this.textures[0],h&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new q(t,{width:e,height:i,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(a&&!o&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),o&&!a&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),a&&o&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.renderer.bindFramebuffer({target:this.target})}setSize(t,e){if(!(this.width===t&&this.height===e)){this.width=t,this.height=e,this.gl.renderer.bindFramebuffer(this);for(let i=0;i<this.textures.length;i++)this.textures[i].width=t,this.textures[i].height=e,this.textures[i].needsUpdate=!0,this.textures[i].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+i,this.gl.TEXTURE_2D,this.textures[i].texture,0);this.depthTexture?(this.depthTexture.width=t,this.depthTexture.height=e,this.depthTexture.needsUpdate=!0,this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(this.depthBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,t,e)),this.stencilBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,t,e)),this.depthStencilBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,t,e))),this.gl.renderer.bindFramebuffer({target:this.target})}}};var yi={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function wi(r){r.length===4&&(r=r[0]+r[1]+r[1]+r[2]+r[2]+r[3]+r[3]);let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return t||console.warn("Unable to convert hex string ".concat(r," to rgb values")),[parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255]}function vs(r){return r=parseInt(r),[(r>>16&255)/255,(r>>8&255)/255,(r&255)/255]}function ce(r){return r===void 0?[0,0,0]:arguments.length===3?arguments:isNaN(r)?r[0]==="#"?wi(r):yi[r.toLowerCase()]?wi(yi[r.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0]):vs(r)}var ot=class extends Array{constructor(t){return Array.isArray(t)?super(...t):super(...ce(...arguments))}get r(){return this[0]}get g(){return this[1]}get b(){return this[2]}set r(t){this[0]=t}set g(t){this[1]=t}set b(t){this[2]=t}set(t){return Array.isArray(t)?this.copy(t):this.copy(ce(...arguments))}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}};function Mi(r,t){return r[0]=t[0],r[1]=t[1],r}function Ei(r,t,e){return r[0]=t,r[1]=e,r}function fe(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r}function ue(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r}function Ai(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r}function vi(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r}function Bt(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r}function bi(r,t){var e=t[0]-r[0],i=t[1]-r[1];return Math.sqrt(e*e+i*i)}function Fi(r,t){var e=t[0]-r[0],i=t[1]-r[1];return e*e+i*i}function pe(r){var t=r[0],e=r[1];return Math.sqrt(t*t+e*e)}function Ti(r){var t=r[0],e=r[1];return t*t+e*e}function _i(r,t){return r[0]=-t[0],r[1]=-t[1],r}function Ri(r,t){return r[0]=1/t[0],r[1]=1/t[1],r}function Li(r,t){var e=t[0],i=t[1],s=e*e+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r}function zi(r,t){return r[0]*t[0]+r[1]*t[1]}function de(r,t){return r[0]*t[1]-r[1]*t[0]}function Si(r,t,e,i){var s=t[0],n=t[1];return r[0]=s+i*(e[0]-s),r[1]=n+i*(e[1]-n),r}function Pi(r,t,e){var i=t[0],s=t[1];return r[0]=e[0]*i+e[3]*s+e[6],r[1]=e[1]*i+e[4]*s+e[7],r}function Ci(r,t,e){let i=t[0],s=t[1];return r[0]=e[0]*i+e[4]*s+e[12],r[1]=e[1]*i+e[5]*s+e[13],r}function Ni(r,t){return r[0]===t[0]&&r[1]===t[1]}var k=class r extends Array{constructor(t=0,e=t){return super(t,e),this}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}set(t,e=t){return t.length?this.copy(t):(Ei(this,t,e),this)}copy(t){return Mi(this,t),this}add(t,e){return e?fe(this,t,e):fe(this,this,t),this}sub(t,e){return e?ue(this,t,e):ue(this,this,t),this}multiply(t){return t.length?Ai(this,this,t):Bt(this,this,t),this}divide(t){return t.length?vi(this,this,t):Bt(this,this,1/t),this}inverse(t=this){return Ri(this,t),this}len(){return pe(this)}distance(t){return t?bi(this,t):pe(this)}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?Fi(this,t):Ti(this)}negate(t=this){return _i(this,t),this}cross(t,e){return e?de(t,e):de(this,t)}scale(t){return Bt(this,this,t),this}normalize(){return Li(this,this),this}dot(t){return zi(this,t)}equals(t){return Ni(this,t)}applyMatrix3(t){return Pi(this,this,t),this}applyMatrix4(t){return Ci(this,this,t),this}lerp(t,e){return Si(this,this,t,e),this}clone(){return new r(this[0],this[1])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t}};var xt=class extends Array{constructor(t=0,e=t,i=t,s=t){return super(t,e,i,s),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set w(t){this[3]=t}set(t,e=t,i=t,s=t){return t.length?this.copy(t):(Nt(this,t,e,i,s),this)}copy(t){return Ct(this,t),this}normalize(){return It(this,this),this}multiply(t){return ie(this,this,t),this}dot(t){return Ot(this,t)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}};var tt=class r extends O{constructor(t,{width:e=1,height:i=1,widthSegments:s=1,heightSegments:n=1,attributes:a={}}={}){let o=s,h=n,l=(o+1)*(h+1),c=o*h*6,f=new Float32Array(l*3),u=new Float32Array(l*3),p=new Float32Array(l*2),d=c>65536?new Uint32Array(c):new Uint16Array(c);r.buildPlane(f,u,p,d,e,i,0,o,h),Object.assign(a,{position:{size:3,data:f},normal:{size:3,data:u},uv:{size:2,data:p},index:{data:d}}),super(t,a)}static buildPlane(t,e,i,s,n,a,o,h,l,c=0,f=1,u=2,p=1,d=-1,x=0,m=0){let g=x,w=n/h,y=a/l;for(let b=0;b<=l;b++){let A=b*y-a/2;for(let E=0;E<=h;E++,x++){let T=E*w-n/2;if(t[x*3+c]=T*p,t[x*3+f]=A*d,t[x*3+u]=o/2,e[x*3+c]=0,e[x*3+f]=0,e[x*3+u]=o>=0?1:-1,i[x*2]=E/h,i[x*2+1]=1-b/l,b===l||E===h)continue;let v=g+E+b*(h+1),R=g+E+(b+1)*(h+1),z=g+E+(b+1)*(h+1)+1,P=g+E+b*(h+1)+1;s[m*6]=v,s[m*6+1]=R,s[m*6+2]=P,s[m*6+3]=R,s[m*6+4]=z,s[m*6+5]=P,m++}}}};var me=class extends O{constructor(t,{width:e=1,height:i=1,depth:s=1,widthSegments:n=1,heightSegments:a=1,depthSegments:o=1,attributes:h={}}={}){let l=n,c=a,f=o,u=(l+1)*(c+1)*2+(l+1)*(f+1)*2+(c+1)*(f+1)*2,p=(l*c*2+l*f*2+c*f*2)*6,d=new Float32Array(u*3),x=new Float32Array(u*3),m=new Float32Array(u*2),g=u>65536?new Uint32Array(p):new Uint16Array(p),w=0,y=0;tt.buildPlane(d,x,m,g,s,i,e,f,c,2,1,0,-1,-1,w,y),w+=(f+1)*(c+1),y+=f*c,tt.buildPlane(d,x,m,g,s,i,-e,f,c,2,1,0,1,-1,w,y),w+=(f+1)*(c+1),y+=f*c,tt.buildPlane(d,x,m,g,e,s,i,f,l,0,2,1,1,1,w,y),w+=(l+1)*(f+1),y+=l*f,tt.buildPlane(d,x,m,g,e,s,-i,f,l,0,2,1,1,-1,w,y),w+=(l+1)*(f+1),y+=l*f,tt.buildPlane(d,x,m,g,e,i,-s,l,c,0,1,2,-1,-1,w,y),w+=(l+1)*(c+1),y+=l*c,tt.buildPlane(d,x,m,g,e,i,s,l,c,0,1,2,1,-1,w,y),Object.assign(h,{position:{size:3,data:d},normal:{size:3,data:x},uv:{size:2,data:m},index:{data:g}}),super(t,h)}};var ge=class extends O{constructor(t,{radius:e=.5,widthSegments:i=16,heightSegments:s=Math.ceil(i*.5),phiStart:n=0,phiLength:a=Math.PI*2,thetaStart:o=0,thetaLength:h=Math.PI,attributes:l={}}={}){let c=i,f=s,u=n,p=a,d=o,x=h,m=(c+1)*(f+1),g=c*f*6,w=new Float32Array(m*3),y=new Float32Array(m*3),b=new Float32Array(m*2),A=m>65536?new Uint32Array(g):new Uint16Array(g),E=0,T=0,v=0,R=d+x,z=[],P=new M;for(let _=0;_<=f;_++){let S=[],F=_/f;for(let C=0;C<=c;C++,E++){let I=C/c,V=-e*Math.cos(u+I*p)*Math.sin(d+F*x),N=e*Math.cos(d+F*x),W=e*Math.sin(u+I*p)*Math.sin(d+F*x);w[E*3]=V,w[E*3+1]=N,w[E*3+2]=W,P.set(V,N,W).normalize(),y[E*3]=P.x,y[E*3+1]=P.y,y[E*3+2]=P.z,b[E*2]=I,b[E*2+1]=1-F,S.push(T++)}z.push(S)}for(let _=0;_<f;_++)for(let S=0;S<c;S++){let F=z[_][S+1],C=z[_][S],I=z[_+1][S],V=z[_+1][S+1];(_!==0||d>0)&&(A[v*3]=F,A[v*3+1]=C,A[v*3+2]=V,v++),(_!==f-1||R<Math.PI)&&(A[v*3]=C,A[v*3+1]=I,A[v*3+2]=V,v++)}Object.assign(l,{position:{size:3,data:w},normal:{size:3,data:y},uv:{size:2,data:b},index:{data:A}}),super(t,l)}};var xe=class extends O{constructor(t,{radiusTop:e=.5,radiusBottom:i=.5,height:s=1,radialSegments:n=8,heightSegments:a=1,openEnded:o=!1,thetaStart:h=0,thetaLength:l=Math.PI*2,attributes:c={}}={}){let f=n,u=a,p=h,d=l,x=o?0:i&&e?2:1,m=(f+1)*(u+1+x)+x,g=f*u*6+x*f*3,w=new Float32Array(m*3),y=new Float32Array(m*3),b=new Float32Array(m*2),A=m>65536?new Uint32Array(g):new Uint16Array(g),E=0,T=0,v=[];R(),o||(e&&z(!0),i&&z(!1));function R(){let P,_,S=new M,F=(i-e)/s;for(_=0;_<=u;_++){let C=[],I=_/u,V=I*(i-e)+e;for(P=0;P<=f;P++){let N=P/f,W=N*d+p,Q=Math.sin(W),J=Math.cos(W);w.set([V*Q,(.5-I)*s,V*J],E*3),S.set(Q,F,J).normalize(),y.set([S.x,S.y,S.z],E*3),b.set([N,1-I],E*2),C.push(E++)}v.push(C)}for(P=0;P<f;P++)for(_=0;_<u;_++){let C=v[_][P],I=v[_+1][P],V=v[_+1][P+1],N=v[_][P+1];A.set([C,I,N,I,V,N],T*3),T+=2}}function z(P){let _,S=P===!0?e:i,F=P===!0?1:-1,C=E;for(w.set([0,.5*s*F,0],E*3),y.set([0,F,0],E*3),b.set([.5,.5],E*2),E++,_=0;_<=f;_++){let V=_/f*d+p,N=Math.cos(V),W=Math.sin(V);w.set([S*W,.5*s*F,S*N],E*3),y.set([0,F,0],E*3),b.set([N*.5+.5,W*.5*F+.5],E*2),E++}for(_=0;_<f;_++){let I=C+_+1;P?A.set([I,I+1,C],T*3):A.set([I+1,I,C],T*3),T++}}Object.assign(c,{position:{size:3,data:w},normal:{size:3,data:y},uv:{size:2,data:b},index:{data:A}}),super(t,c)}};var rt=class extends O{constructor(t,{attributes:e={}}={}){Object.assign(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(t,e)}};var ye=class extends O{constructor(t,{radius:e=.5,tube:i=.2,radialSegments:s=8,tubularSegments:n=6,arc:a=Math.PI*2,attributes:o={}}={}){let h=(s+1)*(n+1),l=s*n*6,c=new Float32Array(h*3),f=new Float32Array(h*3),u=new Float32Array(h*2),p=h>65536?new Uint32Array(l):new Uint16Array(l),d=new M,x=new M,m=new M,g=0;for(let w=0;w<=s;w++)for(let y=0;y<=n;y++,g++){let b=y/n*a,A=w/s*Math.PI*2;x.x=(e+i*Math.cos(A))*Math.cos(b),x.y=(e+i*Math.cos(A))*Math.sin(b),x.z=i*Math.sin(A),c.set([x.x,x.y,x.z],g*3),d.x=e*Math.cos(b),d.y=e*Math.sin(b),m.sub(x,d).normalize(),f.set([m.x,m.y,m.z],g*3),u.set([y/n,w/s],g*2)}g=0;for(let w=1;w<=s;w++)for(let y=1;y<=n;y++,g++){let b=(n+1)*w+y-1,A=(n+1)*(w-1)+y-1,E=(n+1)*(w-1)+y,T=(n+1)*w+y;p.set([b,A,T,A,E,T],g*6)}Object.assign(o,{position:{size:3,data:c},normal:{size:3,data:f},uv:{size:2,data:u},index:{data:p}}),super(t,o)}};var j={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,DOLLY_PAN:3},st=new M,Z=new k,$=new k;function Ts(r,{element:t=document,enabled:e=!0,target:i=new M,ease:s=.25,inertia:n=.85,enableRotate:a=!0,rotateSpeed:o=.1,autoRotate:h=!1,autoRotateSpeed:l=1,enableZoom:c=!0,zoomSpeed:f=1,zoomStyle:u="dolly",enablePan:p=!0,panSpeed:d=.1,minPolarAngle:x=0,maxPolarAngle:m=Math.PI,minAzimuthAngle:g=-1/0,maxAzimuthAngle:w=1/0,minDistance:y=0,maxDistance:b=1/0}={}){this.enabled=e,this.target=i,this.zoomStyle=u,s=s||1,n=n||0,this.minDistance=y,this.maxDistance=b;let A={radius:1,phi:0,theta:0},E={radius:1,phi:0,theta:0},T={radius:1,phi:0,theta:0},v=new M,R=new M;R.copy(r.position).sub(this.target),T.radius=E.radius=R.distance(),T.theta=E.theta=Math.atan2(R.x,R.z),T.phi=E.phi=Math.acos(Math.min(Math.max(R.y/E.radius,-1),1)),this.offset=R,this.update=()=>{h&&W(),E.radius*=A.radius,E.theta+=A.theta,E.phi+=A.phi,E.theta=Math.max(g,Math.min(w,E.theta)),E.phi=Math.max(x,Math.min(m,E.phi)),E.radius=Math.max(this.minDistance,Math.min(this.maxDistance,E.radius)),T.phi+=(E.phi-T.phi)*s,T.theta+=(E.theta-T.theta)*s,T.radius+=(E.radius-T.radius)*s,this.target.add(v);let L=T.radius*Math.sin(Math.max(1e-6,T.phi));R.x=L*Math.sin(T.theta),R.y=T.radius*Math.cos(T.phi),R.z=L*Math.cos(T.theta),r.position.copy(this.target).add(R),r.lookAt(this.target),A.theta*=n,A.phi*=n,v.multiply(n),A.radius=1},this.forcePosition=()=>{R.copy(r.position).sub(this.target),T.radius=E.radius=R.distance(),T.theta=E.theta=Math.atan2(R.x,R.z),T.phi=E.phi=Math.acos(Math.min(Math.max(R.y/E.radius,-1),1)),r.lookAt(this.target)};let z=new k,P=new k,_=new k,S=j.NONE;this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};function F(){return Math.pow(.95,f)}function C(L,G){st.set(G[0],G[1],G[2]),st.multiply(-L),v.add(st)}function I(L,G){st.set(G[4],G[5],G[6]),st.multiply(L),v.add(st)}let V=(L,G)=>{let X=t===document?document.body:t;st.copy(r.position).sub(this.target);let at=st.distance();at*=Math.tan((r.fov||45)/2*Math.PI/180),C(2*L*at/X.clientHeight,r.matrix),I(2*G*at/X.clientHeight,r.matrix)},N=L=>{this.zoomStyle==="dolly"?A.radius/=L:(r.fov/=L,r.type==="orthographic"?r.orthographic():r.perspective())};function W(){let L=2*Math.PI/60/60*l;A.theta-=L}function Q(L,G){Z.set(L,G),$.sub(Z,z).multiply(o);let X=t===document?document.body:t;A.theta-=2*Math.PI*$.x/X.clientHeight,A.phi-=2*Math.PI*$.y/X.clientHeight,z.copy(Z)}function J(L){Z.set(L.clientX,L.clientY),$.sub(Z,_),$.y>0?N(F()):$.y<0&&N(1/F()),_.copy(Z)}function nt(L,G){Z.set(L,G),$.sub(Z,P).multiply(d),V($.x,$.y),P.copy(Z)}function is(L){if(c){let G=L.touches[0].pageX-L.touches[1].pageX,X=L.touches[0].pageY-L.touches[1].pageY,at=Math.sqrt(G*G+X*X);_.set(0,at)}if(p){let G=.5*(L.touches[0].pageX+L.touches[1].pageX),X=.5*(L.touches[0].pageY+L.touches[1].pageY);P.set(G,X)}}function ss(L){if(c){let G=L.touches[0].pageX-L.touches[1].pageX,X=L.touches[0].pageY-L.touches[1].pageY,at=Math.sqrt(G*G+X*X);Z.set(0,at),$.set(0,Math.pow(Z.y/_.y,f)),N($.y),_.copy(Z)}if(p){let G=.5*(L.touches[0].pageX+L.touches[1].pageX),X=.5*(L.touches[0].pageY+L.touches[1].pageY);nt(G,X)}}let rr=L=>{if(this.enabled){switch(L.button){case this.mouseButtons.ORBIT:if(a===!1)return;z.set(L.clientX,L.clientY),S=j.ROTATE;break;case this.mouseButtons.ZOOM:if(c===!1)return;_.set(L.clientX,L.clientY),S=j.DOLLY;break;case this.mouseButtons.PAN:if(p===!1)return;P.set(L.clientX,L.clientY),S=j.PAN;break}S!==j.NONE&&(window.addEventListener("mousemove",jt,!1),window.addEventListener("mouseup",Xt,!1))}},jt=L=>{if(this.enabled)switch(S){case j.ROTATE:if(a===!1)return;Q(L.clientX,L.clientY);break;case j.DOLLY:if(c===!1)return;J(L);break;case j.PAN:if(p===!1)return;nt(L.clientX,L.clientY);break}},Xt=()=>{window.removeEventListener("mousemove",jt,!1),window.removeEventListener("mouseup",Xt,!1),S=j.NONE},ir=L=>{!this.enabled||!c||S!==j.NONE&&S!==j.ROTATE||(L.stopPropagation(),L.preventDefault(),L.deltaY<0?N(1/F()):L.deltaY>0&&N(F()))},sr=L=>{if(this.enabled)switch(L.preventDefault(),L.touches.length){case 1:if(a===!1)return;z.set(L.touches[0].pageX,L.touches[0].pageY),S=j.ROTATE;break;case 2:if(c===!1&&p===!1)return;is(L),S=j.DOLLY_PAN;break;default:S=j.NONE}},nr=L=>{if(this.enabled)switch(L.preventDefault(),L.stopPropagation(),L.touches.length){case 1:if(a===!1)return;Q(L.touches[0].pageX,L.touches[0].pageY);break;case 2:if(c===!1&&p===!1)return;ss(L);break;default:S=j.NONE}},ar=()=>{this.enabled&&(S=j.NONE)},or=L=>{this.enabled&&L.preventDefault()};function ns(){t.addEventListener("contextmenu",or,!1),t.addEventListener("mousedown",rr,!1),t.addEventListener("wheel",ir,{passive:!1}),t.addEventListener("touchstart",sr,{passive:!1}),t.addEventListener("touchend",ar,!1),t.addEventListener("touchmove",nr,{passive:!1})}this.remove=function(){t.removeEventListener("contextmenu",or),t.removeEventListener("mousedown",rr),t.removeEventListener("wheel",ir),t.removeEventListener("touchstart",sr),t.removeEventListener("touchend",ar),t.removeEventListener("touchmove",nr),window.removeEventListener("mousemove",jt),window.removeEventListener("mouseup",Xt)},ns()}var _s=new k,Rs=new k,Ls=new k,we=new M,Ii=new M,Oi=new M,zs=new M,Ss=new M,Ps=new M,Bi=new M,Me=new M,Vi=new M,Di=new M,Cs=new M,Ui=new D,Ee=class{constructor(){this.origin=new M,this.direction=new M}castMouse(t,e=[0,0]){if(t.type==="orthographic"){let{left:i,right:s,bottom:n,top:a,zoom:o}=t,h=i/o+(s-i)/o*(e[0]*.5+.5),l=n/o+(a-n)/o*(e[1]*.5+.5);this.origin.set(h,l,0),this.origin.applyMatrix4(t.worldMatrix),this.direction.x=-t.worldMatrix[8],this.direction.y=-t.worldMatrix[9],this.direction.z=-t.worldMatrix[10]}else t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(t,{maxDistance:e,output:i=[]}={}){Array.isArray(t)||(t=[t]);let s=Ui,n=we,a=Ii,o=i;return o.length=0,t.forEach(h=>{(!h.geometry.bounds||h.geometry.bounds.radius===1/0)&&h.geometry.computeBoundingSphere();let l=h.geometry.bounds;s.inverse(h.worldMatrix);let c;if(e&&(a.copy(this.direction).scaleRotateMatrix4(s),c=e*a.len()),n.copy(this.origin).applyMatrix4(s),a.copy(this.direction).transformDirection(s),e&&n.distance(l.center)-l.radius>c)return;let f=0;if(h.geometry.raycast==="sphere"){if(n.distance(l.center)>l.radius&&(f=this.intersectSphere(l,n,a),!f))return}else if((n.x<l.min.x||n.x>l.max.x||n.y<l.min.y||n.y>l.max.y||n.z<l.min.z||n.z>l.max.z)&&(f=this.intersectBox(l,n,a),!f))return;e&&f>c||(h.hit||(h.hit={localPoint:new M,point:new M}),h.hit.localPoint.copy(a).multiply(f).add(n),h.hit.point.copy(h.hit.localPoint).applyMatrix4(h.worldMatrix),h.hit.distance=h.hit.point.distance(this.origin),o.push(h))}),o.sort((h,l)=>h.hit.distance-l.hit.distance),o}intersectMeshes(t,{cullFace:e=!0,maxDistance:i,includeUV:s=!0,includeNormal:n=!0,output:a=[]}={}){let o=this.intersectBounds(t,{maxDistance:i,output:a});if(!o.length)return o;let h=Ui,l=we,c=Ii,f=Oi,u=zs,p=Ss,d=Ps,x=Bi,m=Me,g=_s,w=Rs,y=Ls;for(let b=o.length-1;b>=0;b--){let A=o[b];h.inverse(A.worldMatrix);let E;i&&(c.copy(this.direction).scaleRotateMatrix4(h),E=i*c.len()),l.copy(this.origin).applyMatrix4(h),c.copy(this.direction).transformDirection(h);let T=0,v,R,z,P=A.geometry,_=P.attributes,S=_.index,F=_.position,C=Math.max(0,P.drawRange.start),I=Math.min(S?S.count:F.count,P.drawRange.start+P.drawRange.count),V=F.size;for(let N=C;N<I;N+=3){let W=S?S.data[N]:N,Q=S?S.data[N+1]:N+1,J=S?S.data[N+2]:N+2;f.fromArray(F.data,W*V),u.fromArray(F.data,Q*V),p.fromArray(F.data,J*V);let nt=this.intersectTriangle(f,u,p,e,l,c,x);nt&&(i&&nt>E||(!T||nt<T)&&(T=nt,v=W,R=Q,z=J,d.copy(x)))}T||o.splice(b,1),A.hit.localPoint.copy(c).multiply(T).add(l),A.hit.point.copy(A.hit.localPoint).applyMatrix4(A.worldMatrix),A.hit.distance=A.hit.point.distance(this.origin),A.hit.faceNormal||(A.hit.localFaceNormal=new M,A.hit.faceNormal=new M,A.hit.uv=new k,A.hit.localNormal=new M,A.hit.normal=new M),A.hit.localFaceNormal.copy(d),A.hit.faceNormal.copy(A.hit.localFaceNormal).transformDirection(A.worldMatrix),(s||n)&&(f.fromArray(F.data,v*3),u.fromArray(F.data,R*3),p.fromArray(F.data,z*3),this.getBarycoord(A.hit.localPoint,f,u,p,m)),s&&_.uv&&(g.fromArray(_.uv.data,v*2),w.fromArray(_.uv.data,R*2),y.fromArray(_.uv.data,z*2),A.hit.uv.set(g.x*m.x+w.x*m.y+y.x*m.z,g.y*m.x+w.y*m.y+y.y*m.z)),n&&_.normal&&(f.fromArray(_.normal.data,v*3),u.fromArray(_.normal.data,R*3),p.fromArray(_.normal.data,z*3),A.hit.localNormal.set(f.x*m.x+u.x*m.y+p.x*m.z,f.y*m.x+u.y*m.y+p.y*m.z,f.z*m.x+u.z*m.y+p.z*m.z),A.hit.normal.copy(A.hit.localNormal).transformDirection(A.worldMatrix))}return o.sort((b,A)=>b.hit.distance-A.hit.distance),o}intersectPlane(t,e=this.origin,i=this.direction){let s=we;s.sub(t.origin,e);let n=s.dot(t.normal),a=i.dot(t.normal);if(a==0)return 0;let o=n/a;return o<=0?0:e.add(i.scale(o))}intersectSphere(t,e=this.origin,i=this.direction){let s=Oi;s.sub(t.center,e);let n=s.dot(i),a=s.dot(s)-n*n,o=t.radius*t.radius;if(a>o)return 0;let h=Math.sqrt(o-a),l=n-h,c=n+h;return l<0&&c<0?0:l<0?c:l}intersectBox(t,e=this.origin,i=this.direction){let s,n,a,o,h,l,c=1/i.x,f=1/i.y,u=1/i.z,p=t.min,d=t.max;return s=((c>=0?p.x:d.x)-e.x)*c,n=((c>=0?d.x:p.x)-e.x)*c,a=((f>=0?p.y:d.y)-e.y)*f,o=((f>=0?d.y:p.y)-e.y)*f,s>o||a>n||(a>s&&(s=a),o<n&&(n=o),h=((u>=0?p.z:d.z)-e.z)*u,l=((u>=0?d.z:p.z)-e.z)*u,s>l||h>n)||(h>s&&(s=h),l<n&&(n=l),n<0)?0:s>=0?s:n}intersectTriangle(t,e,i,s=!0,n=this.origin,a=this.direction,o=Bi){let h=Me,l=Vi,c=Di;h.sub(e,t),l.sub(i,t),o.cross(h,l);let f=a.dot(o);if(!f)return 0;let u;if(f>0){if(s)return 0;u=1}else u=-1,f=-f;c.sub(n,t);let p=u*a.dot(l.cross(c,l));if(p<0)return 0;let d=u*a.dot(h.cross(c));if(d<0||p+d>f)return 0;let x=-u*c.dot(o);return x<0?0:x/f}getBarycoord(t,e,i,s,n=Me){let a=Vi,o=Di,h=Cs;a.sub(s,e),o.sub(i,e),h.sub(t,e);let l=a.dot(a),c=a.dot(o),f=a.dot(h),u=o.dot(o),p=o.dot(h),d=l*u-c*c;if(d===0)return n.set(-2,-1,-1);let x=1/d,m=(u*f-c*p)*x,g=(l*p-c*f)*x;return n.set(1-m-g,g,m)}};var Ae="catmullrom",ve="cubicbezier",Wi="quadraticbezier",ht=new M,lt=new M,Vt=new M,Gi=new M;function Ns(r,t,e=.168,i=.168){if(t<1?ht.sub(r[1],r[0]).scale(e).add(r[0]):ht.sub(r[t+1],r[t-1]).scale(e).add(r[t]),t>r.length-3){let s=r.length-1;lt.sub(r[s-1],r[s]).scale(i).add(r[s])}else lt.sub(r[t],r[t+2]).scale(i).add(r[t+1]);return[ht.clone(),lt.clone()]}function ki(r,t,e,i){let s=1-r;ht.copy(t).scale(s**2),lt.copy(e).scale(2*s*r),Vt.copy(i).scale(r**2);let n=new M;return n.add(ht,lt).add(Vt),n}function qi(r,t,e,i,s){let n=1-r;ht.copy(t).scale(n**3),lt.copy(e).scale(3*n**2*r),Vt.copy(i).scale(3*n*r**2),Gi.copy(s).scale(r**3);let a=new M;return a.add(ht,lt).add(Vt).add(Gi),a}var ut=class r{constructor({points:t=[new M(0,0,0),new M(0,1,0),new M(1,1,0),new M(1,0,0)],divisions:e=12,type:i=Ae}={}){this.points=t,this.divisions=e,this.type=i}_getQuadraticBezierPoints(t=this.divisions){let e=[],i=this.points.length;if(i<3)return console.warn("Not enough points provided."),[];let s=this.points[0],n=this.points[1],a=this.points[2];for(let h=0;h<=t;h++){let l=ki(h/t,s,n,a);e.push(l)}let o=3;for(;i-o>0;){s.copy(a),n=a.scale(2).sub(n),a=this.points[o];for(let h=1;h<=t;h++){let l=ki(h/t,s,n,a);e.push(l)}o++}return e}_getCubicBezierPoints(t=this.divisions){let e=[],i=this.points.length;if(i<4)return console.warn("Not enough points provided."),[];let s=this.points[0],n=this.points[1],a=this.points[2],o=this.points[3];for(let l=0;l<=t;l++){let c=qi(l/t,s,n,a,o);e.push(c)}let h=4;for(;i-h>1;){s.copy(o),n=o.scale(2).sub(a),a=this.points[h],o=this.points[h+1];for(let l=1;l<=t;l++){let c=qi(l/t,s,n,a,o);e.push(c)}h+=2}return e}_getCatmullRomPoints(t=this.divisions,e=.168,i=.168){let s=[];if(this.points.length<=2)return this.points;let a;return this.points.forEach((o,h)=>{if(h===0)a=o;else{let[l,c]=Ns(this.points,h-1,e,i),f=new r({points:[a,l,c,o],type:ve});s.pop(),s.push(...f.getPoints(t)),a=o}}),s}getPoints(t=this.divisions,e=.168,i=.168){let s=this.type;return s===Wi?this._getQuadraticBezierPoints(t):s===ve?this._getCubicBezierPoints(t):s===Ae?this._getCatmullRomPoints(t,e,i):this.points}};ut.CATMULLROM=Ae;ut.CUBICBEZIER=ve;ut.QUADRATICBEZIER=Wi;var it=class{constructor(){this._len=-1,this.tiltStart=0,this.tiltEnd=0}getLength(){return this._len<0&&this.updateLength(),this._len}getTiltAt(t){return this.tiltStart*(1-t)*this.tiltEnd*t}clone(){return new this.constructor().copy(this)}copy(t){return this._len=t._len,this.tiltStart=t.tiltStart,this.tiltEnd=t.tiltEnd,this}};var pt=[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Dt=[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],ji=r=>r*Math.PI/180,Xi=r=>180*r/Math.PI,Ut=(r,t,e)=>Math.max(t,Math.min(r,e));function Yi(r,t,e,i){let s=t[0],n=t[1],a=t[2],o=1-i;return r[0]=s*s*o+i,r[1]=n*s*o+a*e,r[2]=a*s*o-n*e,r[3]=0,r[4]=s*n*o-a*e,r[5]=n*n*o+i,r[6]=a*n*o+s*e,r[7]=0,r[8]=s*a*o+n*e,r[9]=n*a*o-s*e,r[10]=a*a*o+i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function be(r,t,e,i=t,s=e){let n=Math.sin(r),a=Math.cos(r),o=a*t.x+n*e.x,h=a*t.y+n*e.y,l=a*t.z+n*e.z,c=a*e.x-n*t.x,f=a*e.y-n*t.y,u=a*e.z-n*t.z;i.set(o,h,l),s.set(c,f,u)}var Is=new M;function Fe(r,t,e,i,s){let n=1-r;return n*n*n*t+3*n*n*r*e+3*n*r*r*i+r*r*r*s}function Te(r,t,e,i,s){let n=1-r;return 3*n*n*(e-t)+6*n*r*(i-e)+3*r*r*(s-i)}var yt=class extends it{constructor(t,e,i,s,n=0,a=0){super(),this.p0=t,this.p1=e,this.p2=i,this.p3=s,this.tiltStart=n,this.tiltEnd=a,this._len=-1}updateLength(){let e=pt.length,i=0;for(let s=0,n;s<e;s++)n=.5*pt[s]+.5,i+=Dt[s]*this.getDerivativeAt(n,Is).len();this._len=.5*i}getPointAt(t,e=new M){return e.x=Fe(t,this.p0.x,this.p1.x,this.p2.x,this.p3.x),e.y=Fe(t,this.p0.y,this.p1.y,this.p2.y,this.p3.y),e.z=Fe(t,this.p0.z,this.p1.z,this.p2.z,this.p3.z),e}getDerivativeAt(t,e=new M){return e.x=Te(t,this.p0.x,this.p1.x,this.p2.x,this.p3.x),e.y=Te(t,this.p0.y,this.p1.y,this.p2.y,this.p3.y),e.z=Te(t,this.p0.z,this.p1.z,this.p2.z,this.p3.z),e}getTangentAt(t,e=new M){return this.getDerivativeAt(t,e).normalize()}lastPoint(){return this.p3}};var Os=new M;function _e(r,t,e,i){let s=1-r;return s*s*t+2*s*r*e+r*r*i}function Re(r,t,e,i){return 2*(1-r)*(e-t)+2*r*(i-e)}var wt=class extends it{constructor(t,e,i,s=0,n=0){super(),this.p0=t,this.p1=e,this.p2=i,this.tiltStart=s,this.tiltEnd=n,this._len=-1}updateLength(){let e=pt.length,i=0;for(let s=0,n;s<e;s++)n=.5*pt[s]+.5,i+=Dt[s]*this.getDerivativeAt(n,Os).len();this._len=.5*i}getPointAt(t,e=new M){return e.x=_e(t,this.p0.x,this.p1.x,this.p2.x),e.y=_e(t,this.p0.y,this.p1.y,this.p2.y),e.z=_e(t,this.p0.z,this.p1.z,this.p2.z),e}getDerivativeAt(t,e=new M){return e.x=Re(t,this.p0.x,this.p1.x,this.p2.x),e.y=Re(t,this.p0.y,this.p1.y,this.p2.y),e.z=Re(t,this.p0.z,this.p1.z,this.p2.z),e}getTangentAt(t,e=new M){return this.getDerivativeAt(t,e).normalize()}lastPoint(){return this.p2}};var Bs=new M,Mt=class extends it{constructor(t,e,i=0,s=0){super(),this.p0=t,this.p1=e,this.tiltStart=i,this.tiltEnd=s,this._len=-1}updateLength(){this._len=Bs.sub(this.p1,this.p0).len()}getPointAt(t,e=new M){return Pt(e,this.p0,this.p1,t),e}getTangentAt(t,e=new M){return e.sub(this.p1,this.p0).normalize()}lastPoint(){return this.p1}};var ct=new M,Hi=new D;function Vs(r,t){if(this[r]==null)throw new Error(t)}var Le=class{constructor(){this._segments=[],this._lengthOffsets=null,this._totalLength=-1,this._lastPoint=null,this._lastTilt=0,this._assertLastPoint=Vs.bind(this,"_lastPoint","Can`t get previous point of curve. Did you forget moveTo command?"),this.tiltFunction=null}moveTo(t,e=0){this._totalLength=-1,this._lastPoint=t,this._lastTilt=e}bezierCurveTo(t,e,i,s=0){this._assertLastPoint();let n=new yt(this._lastPoint,t,e,i,this._lastTilt,s);return this.addSegment(n),this}quadraticCurveTo(t,e,i=0){this._assertLastPoint();let s=new wt(this._lastPoint,t,e,this._lastTilt,i);return this.addSegment(s),this}lineTo(t,e=0){this._assertLastPoint();let i=new Mt(this._lastPoint,t,this._lastTilt,e);return this.addSegment(i),this}addSegment(t){return this._totalLength=-1,this._lastPoint=t.lastPoint(),this._lastTilt=t.tiltEnd,this._segments.push(t),this}getSegments(){return this._segments}updateLength(){let t=this._segments.length;this._lengthOffsets=new Array(t);let e=0;for(let i=0;i<t;i++)this._lengthOffsets[i]=e,e+=this._segments[i].getLength();this._totalLength=e}getLength(){return this._totalLength<0&&this.updateLength(),this._totalLength}findSegmentIndexAtLength(t){let e=this.getLength();if(t<=0)return[0,0];if(t>=e)return[this._segments.length-1,1];let i=0,s=this._lengthOffsets.length-1,n=-1,a;for(;i<=s;)if(a=Math.ceil((i+s)/2),a===0||a===this._lengthOffsets.length-1||t>=this._lengthOffsets[a]&&t<this._lengthOffsets[a+1]){n=a;break}else t<this._lengthOffsets[a]?s=a-1:i=a+1;let h=this._segments[n].getLength(),l=(t-this._lengthOffsets[n])/h;return[n,l]}getPointAtLength(t,e=new M){let[i,s]=this.findSegmentIndexAtLength(t);return this._segments[i].getPointAt(s,e)}getPointAt(t,e=new M){let i=this.getLength();return this.getPointAtLength(t*i,e)}getTangentAtLength(t,e=new M){let[i,s]=this.findSegmentIndexAtLength(t);return this._segments[i].getTangentAt(s,e)}getTangentAt(t,e=new M){let i=this.getLength();return this.getTangentAtLength(t*i,e)}getTiltAtLength(t){let[e,i]=this.findSegmentIndexAtLength(t);return this._segments[e].getTiltAt(i)}getTiltAt(t){let e=this.getLength();return this.getTiltAtLength(t*e)}getPoints(t=64){let e=new Array(t+1);for(let i=0;i<=t;i++)e[i]=this.getPointAt(i/t);return e}computeFrenetFrames(t=64,e=!1){var p;let i=new Array(t+1),s=new Array(t+1),n=(p=this.tiltFunction)!=null?p:d=>d,a=this.getLength();for(let d=0;d<=t;d++){let[x,m]=this.findSegmentIndexAtLength(a*d/t),g=this._segments[x];i[d]=g.getTangentAt(m),s[d]=n(g.getTiltAt(m),d/t,this)}let o=Math.abs(i[0].x),h=Math.abs(i[0].y),l=Math.abs(i[0].z),c=new M;o<h&&o<l?c.set(1,0,0):h<o&&h<l?c.set(0,1,0):c.set(0,0,1);let f=new Array(t+1),u=new Array(t+1);f[0]=new M,u[0]=new M,ct.cross(i[0],c).normalize(),f[0].cross(i[0],ct),u[0].cross(i[0],f[0]);for(let d=1;d<i.length;d++){f[d]=f[d-1].clone(),u[d]=new M,ct.cross(i[d-1],i[d]);let x=ct.len();if(x>Number.EPSILON){ct.scale(1/x);let m=Ut(i[d-1].dot(i[d]),-1,1),g=Ut(x,-1,1);Yi(Hi,ct,g,m),f[d].applyMatrix4(Hi)}u[d].cross(i[d],f[d])}for(let d=0;d<s.length;d++)be(ji(s[d]),f[d],u[d]);if(e===!0){let d=f[f.length-1],x=Math.acos(Ut(f[0].dot(d),-1,1))/(f.length-1);i[0].dot(ct.cross(f[0],d))>0&&(x=-x);for(let m=1;m<f.length-1;m++){let g=x*m;be(g,f[m],u[m]),s[m]+=Xi(g)}f[f.length-1]=f[0].clone(),u[u.length-1]=u[0].clone()}return{tangents:i,normals:f,binormals:u,tilts:s}}};var Gt=new M,ft=new M,ze=new k,kt=new M,Se=class extends O{constructor(t,{path:e,radius:i=1,tubularSegments:s=64,radialSegments:n=8,closed:a=!1,attributes:o={}}={}){super(t,o),this.path=e,this.radius=i,this.tubularSegments=s,this.radialSegments=n,this.closed=a,this.frenetFrames=e.computeFrenetFrames(s,a);let h=(s+1)*(n+1),l=s*n*6;this.positions=new Float32Array(h*3),this.normals=new Float32Array(h*3),this.uvs=new Float32Array(h*2),this.indices=h>65536?new Uint32Array(l):new Uint16Array(l),this._generateAttributes(),this._generateIndices(),this.addAttribute("position",{size:3,data:this.positions}),this.addAttribute("normal",{size:3,data:this.normals}),this.addAttribute("uv",{size:2,data:this.uvs}),this.setIndex({data:this.indices})}_generateAttributes(){for(let t=0;t<=this.tubularSegments;t++){let e=t;t===this.tubularSegments&&(e=this.closed?0:this.tubularSegments),this.path.getPointAt(e/this.tubularSegments,kt);let i=this.frenetFrames.normals[e],s=this.frenetFrames.binormals[e];for(let n=0;n<=this.radialSegments;n++){let a=n/this.radialSegments*Math.PI*2,o=Math.sin(a),h=-Math.cos(a),l=t*(this.radialSegments+1)+n;ft.x=h*i.x+o*s.x,ft.y=h*i.y+o*s.y,ft.z=h*i.z+o*s.z,this.normals.set(ft,l*3),Gt.x=kt.x+this.radius*ft.x,Gt.y=kt.y+this.radius*ft.y,Gt.z=kt.z+this.radius*ft.z,this.positions.set(Gt,l*3),ze.x=t/this.tubularSegments,ze.y=n/this.radialSegments,this.uvs.set(ze,l*2)}}}_generateIndices(){for(let t=1;t<=this.tubularSegments;t++)for(let e=1;e<=this.radialSegments;e++){let i=(this.radialSegments+1)*(t-1)+(e-1),s=(this.radialSegments+1)*t+(e-1),n=(this.radialSegments+1)*t+e,a=(this.radialSegments+1)*(t-1)+e,o=(t-1)*this.radialSegments+(e-1);this.indices.set([i,s,a,s,n,a],o*6)}}};var Pe=class{constructor(t,{width:e,height:i,dpr:s,wrapS:n=t.CLAMP_TO_EDGE,wrapT:a=t.CLAMP_TO_EDGE,minFilter:o=t.LINEAR,magFilter:h=t.LINEAR,geometry:l=new rt(t),targetOnly:c=null}={}){this.gl=t,this.passes=[],this.geometry=l,this.uniform={value:null},this.targetOnly=c,s&&(this.dpr=s),e&&(this.width=e),i&&(this.height=i),s=this.dpr||this.gl.renderer.dpr,this.resolutionWidth=Math.floor(this.width||this.gl.renderer.width*s),this.resolutionHeight=Math.floor(this.height||this.gl.renderer.height*s);let f={dpr:this.dpr,width:this.resolutionWidth,height:this.resolutionHeight,wrapS:n,wrapT:a,minFilter:o,magFilter:h},u=this.fbo={read:new Y(this.gl,f),write:new Y(this.gl,f),swap:()=>{let p=u.read;u.read=u.write,u.write=p}}}addPass({vertex:t=Ds,fragment:e=Us,uniforms:i={},textureUniform:s="tMap",enabled:n=!0}={}){i[s]={value:this.fbo.read.texture};let a=new U(this.gl,{vertex:t,fragment:e,uniforms:i}),h={mesh:new B(this.gl,{geometry:this.geometry,program:a}),program:a,uniforms:i,enabled:n,textureUniform:s};return this.passes.push(h),h}resize({width:t,height:e,dpr:i}={}){i&&(this.dpr=i),t&&(this.width=t),e&&(this.height=e),i=this.dpr||this.gl.renderer.dpr,this.resolutionWidth=Math.floor(this.width||this.gl.renderer.width*i),this.resolutionHeight=Math.floor(this.height||this.gl.renderer.height*i),this.fbo.read.setSize(this.resolutionWidth,this.resolutionHeight),this.fbo.write.setSize(this.resolutionWidth,this.resolutionHeight)}render({scene:t,camera:e,texture:i,target:s=null,update:n=!0,sort:a=!0,frustumCull:o=!0,beforePostCallbacks:h}){let l=this.passes.filter(c=>c.enabled);i||(this.gl.renderer.render({scene:t,camera:e,target:l.length||!s&&this.targetOnly?this.fbo.write:s,update:n,sort:a,frustumCull:o}),this.fbo.swap(),h&&h.forEach(c=>c&&c())),l.forEach((c,f)=>{c.mesh.program.uniforms[c.textureUniform].value=!f&&i?i:this.fbo.read.texture,this.gl.renderer.render({scene:c.mesh,target:f===l.length-1&&(s||!this.targetOnly)?s:this.fbo.write,clear:!0}),this.fbo.swap()}),this.uniform.value=this.fbo.read.texture}},Ds="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",Us="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n";var Ce=new M,Ne=new K,Ie=new M,Qi=new M,Ki=new K,Zi=new M,Et=class{constructor({objects:t,data:e}){this.objects=t,this.data=e,this.elapsed=0,this.weight=1,this.duration=e.frames.length-1}update(t=1,e){let i=e?1:this.weight/t,s=this.elapsed%this.duration,n=Math.floor(s),a=s-n,o=this.data.frames[n],h=this.data.frames[(n+1)%this.duration];this.objects.forEach((l,c)=>{Ce.fromArray(o.position,c*3),Ne.fromArray(o.quaternion,c*4),Ie.fromArray(o.scale,c*3),Qi.fromArray(h.position,c*3),Ki.fromArray(h.quaternion,c*4),Zi.fromArray(h.scale,c*3),Ce.lerp(Qi,a),Ne.slerp(Ki,a),Ie.lerp(Zi,a),l.position.lerp(Ce,i),l.quaternion.slerp(Ne,i),l.scale.lerp(Ie,i)})}};var $i=new D,Oe=class extends B{constructor(t,{rig:e,geometry:i,program:s,mode:n=t.TRIANGLES}={}){super(t,{geometry:i,program:s,mode:n}),this.createBones(e),this.createBoneTexture(),this.animations=[],Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}})}createBones(t){if(this.root=new H,this.bones=[],!(!t.bones||!t.bones.length)){for(let e=0;e<t.bones.length;e++){let i=new H;i.position.fromArray(t.bindPose.position,e*3),i.quaternion.fromArray(t.bindPose.quaternion,e*4),i.scale.fromArray(t.bindPose.scale,e*3),this.bones.push(i)}t.bones.forEach((e,i)=>{if(this.bones[i].name=e.name,e.parent===-1)return this.bones[i].setParent(this.root);this.bones[i].setParent(this.bones[e.parent])}),this.root.updateMatrixWorld(!0),this.bones.forEach(e=>{e.bindInverse=new D(...e.worldMatrix).inverse()})}}createBoneTexture(){if(!this.bones.length)return;let t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(this.bones.length*4))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new q(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,flipY:!1,width:t})}addAnimation(t){let e=new Et({objects:this.bones,data:t});return this.animations.push(e),e}update(){let t=0;this.animations.forEach(e=>t+=e.weight),this.animations.forEach((e,i)=>{e.update(t,i===0)})}draw({camera:t}={}){this.root.updateMatrixWorld(!0),this.bones.forEach((e,i)=>{$i.multiply(e.worldMatrix,e.bindInverse),this.boneMatrices.set($i,i*16)}),this.boneTexture&&(this.boneTexture.needsUpdate=!0),super.draw({camera:t})}};function Gs({font:r,text:t,width:e=1/0,align:i="left",size:s=1,letterSpacing:n=0,lineHeight:a=1.4,wordSpacing:o=0,wordBreak:h=!1}){let l=this,c,f,u,p,d,x=/\n/,m=/\s/;g(),w();function g(){c={},r.chars.forEach(E=>c[E.char]=E)}function w(){u=r.common.lineHeight,p=r.common.base,d=s/p;let T=t.replace(/[ \n]/g,"").length;f={position:new Float32Array(T*4*3),uv:new Float32Array(T*4*2),id:new Float32Array(T*4),index:new Uint16Array(T*6)};for(let v=0;v<T;v++)f.id.set([v,v,v,v],v*4),f.index.set([v*4,v*4+2,v*4+1,v*4+1,v*4+2,v*4+3],v*6);y()}function y(){let E=[],T=0,v=0,R=0,z=P();function P(){let F={width:0,glyphs:[]};return E.push(F),v=T,R=0,F}let _=100,S=0;for(;T<t.length&&S<_;){S++;let F=t[T];if(!z.width&&m.test(F)){T++,v=T,R=0;continue}if(x.test(F)){T++,z=P();continue}let C=c[F]||c[" "];if(z.glyphs.length){let V=z.glyphs[z.glyphs.length-1][0],N=A(C.id,V.id)*d;z.width+=N,R+=N}z.glyphs.push([C,z.width]);let I=0;if(m.test(F)?(v=T,R=0,I+=o*s):I+=n*s,I+=C.xadvance*d,z.width+=I,R+=I,z.width>e){if(h&&z.glyphs.length>1){z.width-=I,z.glyphs.pop(),z=P();continue}else if(!h&&R!==z.width){let V=T-v+1;z.glyphs.splice(-V,V),T=v,z.width-=R,z=P();continue}}T++,S=0}z.width||E.pop(),b(E)}function b(E){let T=r.common.scaleW,v=r.common.scaleH,R=.07*s,z=0;for(let P=0;P<E.length;P++){let _=E[P];for(let S=0;S<_.glyphs.length;S++){let F=_.glyphs[S][0],C=_.glyphs[S][1];if(i==="center"?C-=_.width*.5:i==="right"&&(C-=_.width),m.test(F.char))continue;C+=F.xoffset*d,R-=F.yoffset*d;let I=F.width*d,V=F.height*d;f.position.set([C,R-V,0,C,R,0,C+I,R-V,0,C+I,R,0],z*4*3);let N=F.x/T,W=F.width/T,Q=1-F.y/v,J=F.height/v;f.uv.set([N,Q-J,N,Q,N+W,Q-J,N+W,Q],z*4*2),R+=F.yoffset*d,z++}R-=s*a}l.buffers=f,l.numLines=E.length,l.height=l.numLines*s*a,l.width=Math.max(...E.map(P=>P.width))}function A(E,T){for(let v=0;v<r.kernings.length;v++){let R=r.kernings[v];if(!(R.first<E)&&!(R.second<T))return R.first>E||R.first===E&&R.second>T?0:R.amount}return 0}this.resize=function(E){({width:e}=E),y()},this.update=function(E){({text:t}=E),w()}}var ks="\n    precision highp float;\n    precision highp int;\n\n    attribute vec3 position;\n    attribute vec3 normal;\n\n    uniform mat3 normalMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vNormal;\n\n    void main() {\n        vNormal = normalize(normalMatrix * normal);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",qs="\n    precision highp float;\n    precision highp int;\n\n    varying vec3 vNormal;\n\n    void main() {\n        gl_FragColor.rgb = normalize(vNormal);\n        gl_FragColor.a = 1.0;\n    }\n";function Be(r){return new U(r,{vertex:ks,fragment:qs,cullFace:!1})}var Ve=class{constructor(t,{size:e=128,falloff:i=.3,alpha:s=1,dissipation:n=.98,type:a}={}){let o=this;this.gl=t,this.uniform={value:null},this.mask={read:null,write:null,swap:()=>{let c=o.mask.read;o.mask.read=o.mask.write,o.mask.write=c,o.uniform.value=o.mask.read.texture}},h(),this.aspect=1,this.mouse=new k,this.velocity=new k,this.mesh=l();function h(){a||(a=t.HALF_FLOAT||t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES);let c=t.renderer.isWebgl2||t.renderer.extensions["OES_texture_".concat(a===t.FLOAT?"":"half_","float_linear")]?t.LINEAR:t.NEAREST,f={width:e,height:e,type:a,format:t.RGBA,internalFormat:t.renderer.isWebgl2?a===t.FLOAT?t.RGBA32F:t.RGBA16F:t.RGBA,minFilter:c,depth:!1};o.mask.read=new Y(t,f),o.mask.write=new Y(t,f),o.mask.swap()}function l(){return new B(t,{geometry:new rt(t),program:new U(t,{vertex:Ws,fragment:js,uniforms:{tMap:o.uniform,uFalloff:{value:i*.5},uAlpha:{value:s},uDissipation:{value:n},uAspect:{value:1},uMouse:{value:o.mouse},uVelocity:{value:o.velocity}},depthTest:!1})})}}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}},Ws="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",js="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n";var De=class{constructor(t,{data:e=new Float32Array(16),geometry:i=new rt(t),type:s}){this.gl=t;let n=e;this.passes=[],this.geometry=i,this.dataLength=n.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(this.dataLength*2);for(let h=0;h<this.dataLength;h++){let l=h%this.size/this.size,c=Math.floor(h/this.size)/this.size;this.coords.set([l,c],h*2)}let a=(()=>{if(n.length===this.size*this.size*4)return n;{let h=new Float32Array(this.size*this.size*4);return h.set(n),h}})();this.uniform={value:new q(t,{image:a,target:t.TEXTURE_2D,type:t.FLOAT,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA32F:t.RGBA,wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:t.NEAREST,magFilter:t.NEAREST,width:this.size,flipY:!1})};let o={width:this.size,height:this.size,type:s||t.HALF_FLOAT||t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,format:t.RGBA,internalFormat:t.renderer.isWebgl2?s===t.FLOAT?t.RGBA32F:t.RGBA16F:t.RGBA,minFilter:t.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new Y(t,o),write:new Y(t,o),swap:()=>{let h=this.fbo.read;this.fbo.read=this.fbo.write,this.fbo.write=h,this.uniform.value=this.fbo.read.texture}}}addPass({vertex:t=Xs,fragment:e=Ys,uniforms:i={},textureUniform:s="tMap",enabled:n=!0}={}){i[s]=this.uniform;let a=new U(this.gl,{vertex:t,fragment:e,uniforms:i}),h={mesh:new B(this.gl,{geometry:this.geometry,program:a}),program:a,uniforms:i,enabled:n,textureUniform:s};return this.passes.push(h),h}render(){this.passes.filter(e=>e.enabled).forEach((e,i)=>{this.gl.renderer.render({scene:e.mesh,target:this.fbo.write,clear:!1}),this.fbo.swap()})}},Xs="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",Ys="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n";var dt=new M,Ue=class{constructor(t,{points:e,vertex:i=Hs,fragment:s=Qs,uniforms:n={},attributes:a={}}){this.gl=t,this.points=e,this.count=e.length,this.position=new Float32Array(this.count*3*2),this.prev=new Float32Array(this.count*3*2),this.next=new Float32Array(this.count*3*2);let o=new Float32Array(this.count*1*2),h=new Float32Array(this.count*2*2),l=new Uint16Array((this.count-1)*3*2);for(let u=0;u<this.count;u++){o.set([-1,1],u*2);let p=u/(this.count-1);if(h.set([0,p,1,p],u*4),u===this.count-1)continue;let d=u*2;l.set([d+0,d+1,d+2],(d+0)*3),l.set([d+2,d+1,d+3],(d+1)*3)}let c=this.geometry=new O(t,Object.assign(a,{position:{size:3,data:this.position},prev:{size:3,data:this.prev},next:{size:3,data:this.next},side:{size:1,data:o},uv:{size:2,data:h},index:{size:1,data:l}}));this.updateGeometry(),n.uResolution||(this.resolution=n.uResolution={value:new k}),n.uDPR||(this.dpr=n.uDPR={value:1}),n.uThickness||(this.thickness=n.uThickness={value:1}),n.uColor||(this.color=n.uColor={value:new ot("#000")}),n.uMiter||(this.miter=n.uMiter={value:1}),this.resize();let f=this.program=new U(t,{vertex:i,fragment:s,uniforms:n});this.mesh=new B(t,{geometry:c,program:f})}updateGeometry(){this.points.forEach((t,e)=>{t.toArray(this.position,e*3*2),t.toArray(this.position,e*3*2+3),e?(t.toArray(this.next,(e-1)*3*2),t.toArray(this.next,(e-1)*3*2+3)):(dt.copy(t).sub(this.points[e+1]).add(t),dt.toArray(this.prev,e*3*2),dt.toArray(this.prev,e*3*2+3)),e===this.points.length-1?(dt.copy(t).sub(this.points[e-1]).add(t),dt.toArray(this.next,e*3*2),dt.toArray(this.next,e*3*2+3)):(t.toArray(this.prev,(e+1)*3*2),t.toArray(this.prev,(e+1)*3*2+3))}),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.prev.needsUpdate=!0,this.geometry.attributes.next.needsUpdate=!0}resize(){this.resolution&&this.resolution.value.set(this.gl.canvas.width,this.gl.canvas.height),this.dpr&&(this.dpr.value=this.gl.renderer.dpr)}},Hs="\n    precision highp float;\n\n    attribute vec3 position;\n    attribute vec3 next;\n    attribute vec3 prev;\n    attribute vec2 uv;\n    attribute float side;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec2 uResolution;\n    uniform float uDPR;\n    uniform float uThickness;\n    uniform float uMiter;\n\n    varying vec2 vUv;\n\n    vec4 getPosition() {\n        mat4 mvp = projectionMatrix * modelViewMatrix;\n        vec4 current = mvp * vec4(position, 1);\n        vec4 nextPos = mvp * vec4(next, 1);\n        vec4 prevPos = mvp * vec4(prev, 1);\n\n        vec2 aspect = vec2(uResolution.x / uResolution.y, 1);    \n        vec2 currentScreen = current.xy / current.w * aspect;\n        vec2 nextScreen = nextPos.xy / nextPos.w * aspect;\n        vec2 prevScreen = prevPos.xy / prevPos.w * aspect;\n    \n        vec2 dir1 = normalize(currentScreen - prevScreen);\n        vec2 dir2 = normalize(nextScreen - currentScreen);\n        vec2 dir = normalize(dir1 + dir2);\n    \n        vec2 normal = vec2(-dir.y, dir.x);\n        normal /= mix(1.0, max(0.3, dot(normal, vec2(-dir1.y, dir1.x))), uMiter);\n        normal /= aspect;\n\n        float pixelWidthRatio = 1.0 / (uResolution.y / uDPR);\n        float pixelWidth = current.w * pixelWidthRatio;\n        normal *= pixelWidth * uThickness;\n        current.xy -= normal * side;\n    \n        return current;\n    }\n\n    void main() {\n        vUv = uv;\n        gl_Position = getPosition();\n    }\n",Qs="\n    precision highp float;\n\n    uniform vec3 uColor;\n    \n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor.rgb = uColor;\n        gl_FragColor.a = 1.0;\n    }\n";var qe=class{constructor(t,{light:e=new gt(t),width:i=1024,height:s=i}){this.gl=t,this.light=e,this.target=new Y(t,{width:i,height:s}),this.targetUniform={value:this.target.texture},this.depthProgram=new U(t,{vertex:Ge,fragment:ke,cullFace:!1}),this.castMeshes=[]}add({mesh:t,receive:e=!0,cast:i=!0,vertex:s=Ge,fragment:n=ke,uniformProjection:a="shadowProjectionMatrix",uniformView:o="shadowViewMatrix",uniformTexture:h="tShadow"}){if(e&&!t.program.uniforms[a]&&(t.program.uniforms[a]={value:this.light.projectionMatrix},t.program.uniforms[o]={value:this.light.viewMatrix},t.program.uniforms[h]=this.targetUniform),!!i&&(this.castMeshes.push(t),t.colorProgram=t.program,!t.depthProgram)){if(s===Ge&&n===ke){t.depthProgram=this.depthProgram;return}t.depthProgram=new U(this.gl,{vertex:s,fragment:n,cullFace:!1})}}setSize({width:t=1024,height:e=t}){this.target=new Y(this.gl,{width:t,height:e}),this.targetUniform.value=this.target.texture}render({scene:t}){t.traverse(e=>{e.draw&&(~this.castMeshes.indexOf(e)?e.program=e.depthProgram:(e.isForceVisibility=e.visible,e.visible=!1))}),this.gl.renderer.render({scene:t,camera:this.light,target:this.target}),t.traverse(e=>{e.draw&&(~this.castMeshes.indexOf(e)?e.program=e.colorProgram:e.visible=e.isForceVisibility)})}},Ge="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",ke="\n    precision highp float;\n\n    vec4 packRGBA (float v) {\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n        return pack;\n    }\n\n    void main() {\n        gl_FragColor = packRGBA(gl_FragCoord.z);\n    }\n";var At=class extends q{constructor(t,{buffer:e,wrapS:i=t.CLAMP_TO_EDGE,wrapT:s=t.CLAMP_TO_EDGE,anisotropy:n=0,minFilter:a,magFilter:o}={}){if(super(t,{generateMipmaps:!1,wrapS:i,wrapT:s,anisotropy:n,minFilter:a,magFilter:o}),e)return this.parseBuffer(e)}parseBuffer(t){let e=new Ks(t);e.mipmaps.isCompressedTexture=!0,this.image=e.mipmaps,this.internalFormat=e.glInternalFormat,e.numberOfMipmapLevels>1?this.minFilter===this.gl.LINEAR&&(this.minFilter=this.gl.NEAREST_MIPMAP_LINEAR):this.minFilter===this.gl.NEAREST_MIPMAP_LINEAR&&(this.minFilter=this.gl.LINEAR)}};function Ks(r){let t=[171,75,84,88,32,49,49,187,13,10,26,10],e=new Uint8Array(r,0,12);for(let f=0;f<e.length;f++)if(e[f]!==t[f])return console.error("File missing KTX identifier");let i=Uint32Array.BYTES_PER_ELEMENT,s=new DataView(r,12,13*i),n=s.getUint32(0,!0)===67305985;if(s.getUint32(1*i,n)!==0)return console.warn("only compressed formats currently supported");this.glInternalFormat=s.getUint32(4*i,n);let o=s.getUint32(6*i,n),h=s.getUint32(7*i,n);this.numberOfFaces=s.getUint32(10*i,n),this.numberOfMipmapLevels=Math.max(1,s.getUint32(11*i,n));let l=s.getUint32(12*i,n);this.mipmaps=[];let c=12+13*4+l;for(let f=0;f<this.numberOfMipmapLevels;f++){let u=new Int32Array(r,c,1)[0];c+=4;for(let p=0;p<this.numberOfFaces;p++){let d=new Uint8Array(r,c,u);this.mipmaps.push({data:d,width:o,height:h}),c+=u,c+=3-(u+3)%4}o=o>>1,h=h>>1}}var qt={},vt=[],We=class{static load(t,{src:e,wrapS:i=t.CLAMP_TO_EDGE,wrapT:s=t.CLAMP_TO_EDGE,anisotropy:n=0,format:a=t.RGBA,internalFormat:o=a,generateMipmaps:h=!0,minFilter:l=h?t.NEAREST_MIPMAP_LINEAR:t.LINEAR,magFilter:c=t.LINEAR,premultiplyAlpha:f=!1,unpackAlignment:u=4,flipY:p=!0}={}){let d=this.getSupportedExtensions(t),x="none";if(typeof e=="string"&&(x=e.split(".").pop().split("?")[0].toLowerCase()),typeof e=="object"){for(let w in e)if(d.includes(w.toLowerCase())){x=w.toLowerCase(),e=e[w];break}}let m=e+i+s+n+a+o+h+l+c+f+u+p+t.renderer.id;if(qt[m])return qt[m];let g;switch(x){case"ktx":case"pvrtc":case"s3tc":case"etc":case"etc1":case"astc":g=new At(t,{src:e,wrapS:i,wrapT:s,anisotropy:n,minFilter:l,magFilter:c}),g.loaded=this.loadKTX(e,g);break;case"webp":case"jpg":case"jpeg":case"png":g=new q(t,{wrapS:i,wrapT:s,anisotropy:n,format:a,internalFormat:o,generateMipmaps:h,minFilter:l,magFilter:c,premultiplyAlpha:f,unpackAlignment:u,flipY:p}),g.loaded=this.loadImage(t,e,g,p);break;default:console.warn("No supported format supplied"),g=new q(t)}return g.ext=x,qt[m]=g,g}static getSupportedExtensions(t){if(vt.length)return vt;let e={pvrtc:t.renderer.getExtension("WEBGL_compressed_texture_pvrtc")||t.renderer.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),s3tc:t.renderer.getExtension("WEBGL_compressed_texture_s3tc"),etc1:t.renderer.getExtension("WEBGL_compressed_texture_etc1"),astc:t.renderer.getExtension("WEBGL_compressed_texture_astc"),bc7:t.renderer.getExtension("EXT_texture_compression_bptc")};for(let i in e)e[i]&&vt.push(i);return vt.push("png","jpg","webp"),vt}static loadKTX(t,e){return fetch(t).then(i=>i.arrayBuffer()).then(i=>e.parseBuffer(i))}static loadImage(t,e,i,s){return Zs(e,s).then(n=>(!t.renderer.isWebgl2&&(!Ji(n.width)||!Ji(n.height))&&(i.generateMipmaps&&(i.generateMipmaps=!1),i.minFilter===t.NEAREST_MIPMAP_LINEAR&&(i.minFilter=t.LINEAR),i.wrapS===t.REPEAT&&(i.wrapS=i.wrapT=t.CLAMP_TO_EDGE)),i.image=n,i.onUpdate=()=>{n.close&&n.close(),i.onUpdate=null},n))}static clearCache(){qt={}}};function Ji(r){return Math.log2(r)%1===0}function Zs(r,t){return new Promise(e=>{if($s())fetch(r,{mode:"cors"}).then(i=>i.blob()).then(i=>createImageBitmap(i,{imageOrientation:t?"flipY":"none",premultiplyAlpha:"none"})).then(e);else{let i=new Image;i.crossOrigin="",i.src=r,i.onload=()=>e(i)}})}function $s(){if(!navigator.userAgent.toLowerCase().includes("chrome"))return!1;try{createImageBitmap}catch(t){return!1}return!0}var ts=new M,Js=new M,tn=new M,en=new M,es=new K,rn=new K,sn=new K,nn=new K,bt=class{constructor(t,e=1){this.data=t,this.elapsed=0,this.weight=e,this.loop=!0,this.startTime=t.reduce((i,{times:s})=>Math.min(i,s[0]),1/0),this.endTime=t.reduce((i,{times:s})=>Math.max(i,s[s.length-1]),0),this.duration=this.endTime-this.startTime}update(t=1,e){let i=e?1:this.weight/t,s=this.duration?(this.loop?this.elapsed%this.duration:Math.min(this.elapsed,this.duration-.001))+this.startTime:0;this.data.forEach(({node:n,transform:a,interpolation:o,times:h,values:l})=>{if(!this.duration){let w=ts,y=3;a==="quaternion"&&(w=es,y=4),w.fromArray(l,0),y===4?n[a].slerp(w,i):n[a].lerp(w,i);return}let c=Math.max(1,h.findIndex(w=>w>s))-1,f=c+1,u=(s-h[c])/(h[f]-h[c]);o==="STEP"&&(u=0);let p=ts,d=Js,x=tn,m=en,g=3;a==="quaternion"&&(p=es,d=rn,x=sn,m=nn,g=4),o==="CUBICSPLINE"?(p.fromArray(l,c*g*3+g*1),d.fromArray(l,c*g*3+g*2),x.fromArray(l,f*g*3+g*0),m.fromArray(l,f*g*3+g*1),p=this.cubicSplineInterpolate(u,p,d,x,m),g===4&&p.normalize()):(p.fromArray(l,c*g),m.fromArray(l,f*g),g===4?p.slerp(m,u):p.lerp(m,u)),g===4?n[a].slerp(p,i):n[a].lerp(p,i)})}cubicSplineInterpolate(t,e,i,s,n){let a=t*t,o=a*t,h=3*a-2*o,l=o-a,c=1-h,f=l-a+t;for(let u=0;u<e.length;u++)e[u]=c*e[u]+f*(1-t)*i[u]+h*n[u]+l*t*s[u];return e}};var rs=new D,an=new D,Ft=class extends B{constructor(t,{skeleton:e,geometry:i,program:s,mode:n=t.TRIANGLES}={}){super(t,{geometry:i,program:s,mode:n}),this.skeleton=e,this.program=s,this.createBoneTexture()}createBoneTexture(){if(!this.skeleton.joints.length)return;let t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(this.skeleton.joints.length*4))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new q(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,flipY:!1,width:t})}updateUniforms(){this.skeleton.joints.forEach((t,e)=>{rs.multiply(t.worldMatrix,t.bindInverse),this.boneMatrices.set(rs,e*16)}),this.boneTexture.needsUpdate=!0,this.program.uniforms.boneTexture.value=this.boneTexture,this.program.uniforms.boneTextureSize.value=this.boneTextureSize}draw({camera:t}={}){this.program.uniforms.boneTexture||Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}}),this.updateUniforms();let e=this.worldMatrix;this.worldMatrix=an,super.draw({camera:t}),this.worldMatrix=e}};var Tt=class extends B{constructor(...t){super(...t),this.frustumCulled=!1,this.isInstancedMesh=!0}addFrustumCull(){this.instanceTransforms=null,this.instanceLightmapScaleOffset=null,this.totalInstanceCount=0,this.frustumCullFunction=null,this.instanceRenderList=null,this.geometry.attributes.instanceMatrix||console.error("mesh ".concat(this.name?'"'.concat(this.name,'" '):"","missing instanceMatrix attribute; unable to frustum cull"));let t=this.geometry.attributes.instanceMatrix.data;this.instanceTransforms=[];for(let e=0,i=0;e<t.length;e+=16,i++){let s=new H;s.index=i,s.matrix.fromArray(t,e),s.decompose(),this.instanceTransforms.push(s),s.setParent(this.parent)}if(this.totalInstanceCount=this.instanceTransforms.length,this.geometry.attributes.lightmapScaleOffset){let e=this.geometry.attributes.lightmapScaleOffset.data;for(let i=0,s=0;i<e.length;i+=4,s++)this.instanceTransforms[s].lightmapData=new xt().fromArray(e,i)}this.frustumCullFunction=({camera:e})=>{this.instanceRenderList=[],this.instanceTransforms.forEach(i=>{e.frustumIntersectsMesh(this,i.worldMatrix)&&this.instanceRenderList.push(i)}),this.instanceRenderList.forEach((i,s)=>{i.matrix.toArray(this.geometry.attributes.instanceMatrix.data,s*16),i.lightmapData&&(i.lightmapData.toArray(this.geometry.attributes.lightmapScaleOffset.data,s*4),this.geometry.attributes.lightmapScaleOffset.needsUpdate=!0)}),this.geometry.instancedCount=this.instanceRenderList.length,this.geometry.attributes.instanceMatrix.needsUpdate=!0},this.onBeforeRender(this.frustumCullFunction)}removeFrustumCull(){this.offBeforeRender(this.frustumCullFunction),this.geometry.instancedCount=this.totalInstanceCount,this.instanceTransforms.forEach((t,e)=>{t.matrix.toArray(this.geometry.attributes.instanceMatrix.data,e*16),t.lightmapData&&(t.lightmapData.toArray(this.geometry.attributes.lightmapScaleOffset.data,e*4),this.geometry.attributes.lightmapScaleOffset.needsUpdate=!0)}),this.geometry.attributes.instanceMatrix.needsUpdate=!0}};var on={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array},hn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ln={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},cn={translation:"position",rotation:"quaternion",scale:"scale"},je=class{static setBasisManager(t){this.basisManager=t}static async load(t,e){let i=e.split("/").slice(0,-1).join("/")+"/",s=await this.parseDesc(e);return this.parse(t,s,i)}static async parse(t,e,i){var m;(e.asset===void 0||e.asset.version[0]<2)&&console.warn("Only GLTF >=2.0 supported. Attempting to parse."),(m=e.extensionsRequired)!=null&&m.includes("KHR_texture_basisu")&&!this.basisManager&&console.warn("KHR_texture_basisu extension required but no manager supplied. Use .setBasisManager()");let s=await this.loadBuffers(e,i);t.renderer.bindVertexArray(null);let n=this.parseBufferViews(t,e,s),a=await this.parseImages(t,e,i,n),o=this.parseTextures(t,e,a),h=this.parseMaterials(t,e,o),l=this.parseSkins(t,e,n),c=this.parseMeshes(t,e,n,h,l),f=this.parseNodes(t,e,c,l,a);this.populateSkins(l,f);let u=this.parseAnimations(t,e,f,n),p=this.parseScenes(e,f),d=p[e.scene],x=this.parseLights(t,e,f,p);for(let g=f.length;g>=0;g--)f[g]||f.splice(g,1);return{json:e,buffers:s,bufferViews:n,images:a,textures:o,materials:h,meshes:c,nodes:f,lights:x,animations:u,scenes:p,scene:d}}static parseDesc(t){return t.match(/\.glb/)?fetch(t).then(e=>e.arrayBuffer()).then(e=>this.unpackGLB(e)):fetch(t).then(e=>e.json())}static unpackGLB(t){let e=new Uint32Array(t,0,3);if(e[0]!==1179937895)throw new Error("Invalid glTF asset.");if(e[1]!==2)throw new Error('Unsupported glTF binary version, "'.concat(e[1],'".'));let i=new Uint32Array(t,12,2),s=20,n=i[0];if(i[1]!==1313821514)throw new Error("Unexpected GLB layout.");let a=new TextDecoder().decode(t.slice(s,s+n)),o=JSON.parse(a);if(s+n===t.byteLength)return o;let h=new Uint32Array(t,s+n,2);if(h[1]!==5130562)throw new Error("Unexpected GLB layout.");let l=s+n+8,c=h[0],f=t.slice(l,l+c);return o.buffers[0].binary=f,o}static resolveURI(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}static loadBuffers(t,e){return t.buffers?Promise.all(t.buffers.map(i=>{if(i.binary)return i.binary;let s=this.resolveURI(i.uri,e);return fetch(s).then(n=>n.arrayBuffer())})):null}static parseBufferViews(t,e,i){if(!e.bufferViews)return null;let s=e.bufferViews.map(n=>Object.assign({},n));return e.meshes&&e.meshes.forEach(({primitives:n})=>{n.forEach(({attributes:a,indices:o})=>{for(let h in a)s[e.accessors[a[h]].bufferView].isAttribute=!0;o!==void 0&&(s[e.accessors[o].bufferView].isAttribute=!0,s[e.accessors[o].bufferView].target=t.ELEMENT_ARRAY_BUFFER)})}),e.accessors.forEach(({bufferView:n,componentType:a})=>{s[n].componentType=a}),e.images&&e.images.forEach(({uri:n,bufferView:a,mimeType:o})=>{a!==void 0&&(s[a].mimeType=o)}),s.forEach(({buffer:n,byteOffset:a=0,byteLength:o,byteStride:h,target:l=t.ARRAY_BUFFER,name:c,extensions:f,extras:u,componentType:p,mimeType:d,isAttribute:x},m)=>{if(s[m].data=i[n].slice(a,a+o),!x)return;let g=t.createBuffer();t.bindBuffer(l,g),t.renderer.state.boundBuffer=g,t.bufferData(l,s[m].data,t.STATIC_DRAW),s[m].buffer=g}),s}static parseImages(t,e,i,s){return e.images?Promise.all(e.images.map(async({uri:n,bufferView:a,mimeType:o,name:h})=>{if(o==="image/ktx2"){let{data:c}=s[a];return await this.basisManager.parseTexture(c)}let l=new Image;if(l.name=h,n)l.src=this.resolveURI(n,i);else if(a!==void 0){let{data:c}=s[a],f=new Blob([c],{type:o});l.src=URL.createObjectURL(f)}return l.ready=new Promise(c=>{l.onload=()=>c()}),l})):null}static parseTextures(t,e,i){return e.textures?e.textures.map(s=>this.createTexture(t,e,i,s)):null}static createTexture(t,e,i,{sampler:s,source:n,name:a,extensions:o,extras:h}){n===void 0&&o&&o.KHR_texture_basisu&&(n=o.KHR_texture_basisu.source);let l=i[n];if(l.texture)return l.texture;let c={flipY:!1,wrapS:t.REPEAT,wrapT:t.REPEAT},f=s!==void 0?e.samplers[s]:null;if(f&&["magFilter","minFilter","wrapS","wrapT"].forEach(p=>{f[p]&&(c[p]=f[p])}),l.isBasis){c.image=l,c.internalFormat=l.internalFormat,l.isCompressedTexture&&(c.generateMipmaps=!1,l.length>1&&(this.minFilter=t.NEAREST_MIPMAP_LINEAR));let p=new q(t,c);return p.name=a,l.texture=p,p}let u=new q(t,c);return u.name=a,l.texture=u,l.ready.then(()=>{u.image=l}),u}static parseMaterials(t,e,i){return e.materials?e.materials.map(({name:s,extensions:n,extras:a,pbrMetallicRoughness:o={},normalTexture:h,occlusionTexture:l,emissiveTexture:c,emissiveFactor:f=[0,0,0],alphaMode:u="OPAQUE",alphaCutoff:p=.5,doubleSided:d=!1})=>{let{baseColorFactor:x=[1,1,1,1],baseColorTexture:m,metallicFactor:g=1,roughnessFactor:w=1,metallicRoughnessTexture:y}=o;return m&&(m.texture=i[m.index]),h&&(h.texture=i[h.index]),y&&(y.texture=i[y.index]),l&&(l.texture=i[l.index]),c&&(c.texture=i[c.index]),{name:s,extensions:n,extras:a,baseColorFactor:x,baseColorTexture:m,metallicFactor:g,roughnessFactor:w,metallicRoughnessTexture:y,normalTexture:h,occlusionTexture:l,emissiveTexture:c,emissiveFactor:f,alphaMode:u,alphaCutoff:p,doubleSided:d}}):null}static parseSkins(t,e,i){return e.skins?e.skins.map(({inverseBindMatrices:s,skeleton:n,joints:a})=>({inverseBindMatrices:this.parseAccessor(s,e,i),skeleton:n,joints:a})):null}static parseMeshes(t,e,i,s,n){return e.meshes?e.meshes.map(({primitives:a,weights:o,name:h,extensions:l,extras:c},f)=>{let u=0,p=[],d=!1;return e.nodes&&e.nodes.forEach(({mesh:m,skin:g,extras:w})=>{m===f&&(u++,g!==void 0&&p.push(g),w&&w.lightmap_scale_offset&&(d=!0))}),!!p.length?(a=p.map(m=>this.parsePrimitives(t,a,e,i,s,1,d).map(({geometry:g,program:w,mode:y})=>{let b=new Ft(t,{skeleton:n[m],geometry:g,program:w,mode:y});return b.name=h,b.frustumCulled=!1,b})),a.instanceCount=0,a.numInstances=u):a=this.parsePrimitives(t,a,e,i,s,u,d).map(({geometry:m,program:g,mode:w})=>{let y=m.attributes.instanceMatrix?Tt:B,b=new y(t,{geometry:m,program:g,mode:w});return b.name=h,b.numInstances=u,b}),{primitives:a,weights:o,name:h}}):null}static parsePrimitives(t,e,i,s,n,a,o){return e.map(({attributes:h,indices:l,material:c,mode:f=4,targets:u,extensions:p,extras:d})=>{let x=new Be(t);c!==void 0&&(x.gltfMaterial=n[c]);let m=new O(t);for(let g in h)m.addAttribute(ln[g],this.parseAccessor(h[g],i,s));return l!==void 0&&m.addAttribute("index",this.parseAccessor(l,i,s)),a>1&&m.addAttribute("instanceMatrix",{instanced:1,size:16,data:new Float32Array(a*16)}),o&&m.addAttribute("lightmapScaleOffset",{instanced:1,size:4,data:new Float32Array(a*4)}),{geometry:m,program:x,mode:f}})}static parseAccessor(t,e,i){let{bufferView:s,byteOffset:n=0,componentType:a,normalized:o=!1,count:h,type:l,min:c,max:f,sparse:u}=e.accessors[t],{data:p,buffer:d,byteOffset:x=0,byteStride:m=0,target:g}=i[s],w=hn[l],y=on[a],b=y.BYTES_PER_ELEMENT,A=m/b,E=!!m&&A!==w,T;if(E){let v=new y(p,n);T=new y(h*w);for(let R=0;R<h;R++){let z=A*R,P=z+w;T.set(v.slice(z,P),R*w)}}else T=new y(p,n,h*w);return{data:T,size:w,type:a,normalized:o,buffer:d,stride:m,offset:n,count:h,min:c,max:f}}static parseNodes(t,e,i,s,n){if(!e.nodes)return null;let a=e.nodes.map(({camera:o,children:h,skin:l,matrix:c,mesh:f,rotation:u,scale:p,translation:d,weights:x,name:m,extensions:g,extras:w})=>{let y=new H;m&&(y.name=m),y.extras=w,y.extensions=g,w&&w.lightmapTexture!==void 0&&(w.lightmapTexture.texture=this.createTexture(t,e,n,{source:w.lightmapTexture.index})),c?(y.matrix.copy(c),y.decompose()):(u&&y.quaternion.copy(u),p&&y.scale.copy(p),d&&y.position.copy(d),y.updateMatrix());let b=!1,A=!0,E=!1;if(f!==void 0&&(l!==void 0?(i[f].primitives[i[f].primitives.instanceCount].forEach(v=>{v.extras=w,v.setParent(y)}),i[f].primitives.instanceCount++,i[f].primitives.instanceCount===i[f].primitives.numInstances&&(delete i[f].primitives.numInstances,delete i[f].primitives.instanceCount)):i[f].primitives.forEach(v=>{v.extras=w,v.geometry.isInstanced&&(b=!0,v.instanceCount?A=!1:v.instanceCount=0,v.geometry.attributes.instanceMatrix&&(E=!0,y.matrix.toArray(v.geometry.attributes.instanceMatrix.data,v.instanceCount*16)),v.geometry.attributes.lightmapScaleOffset&&v.geometry.attributes.lightmapScaleOffset.data.set(w.lightmap_scale_offset,v.instanceCount*4),v.instanceCount++,v.instanceCount===v.numInstances&&(delete v.numInstances,delete v.instanceCount,v.geometry.attributes.instanceMatrix&&(v.geometry.attributes.instanceMatrix.needsUpdate=!0),v.geometry.attributes.lightmapScaleOffset&&(v.geometry.attributes.lightmapScaleOffset.needsUpdate=!0))),b?A&&v.setParent(y):v.setParent(y)})),E){if(!A)return null;y.matrix.identity(),y.decompose()}return y});return e.nodes.forEach(({children:o=[]},h)=>{o.forEach(l=>{a[l]&&a[l].setParent(a[h])})}),i.forEach(({primitives:o},h)=>{o.forEach((l,c)=>{l.isInstancedMesh&&l.addFrustumCull()})}),a}static populateSkins(t,e){t&&t.forEach(i=>{i.joints=i.joints.map((s,n)=>{let a=e[s];return a.skin=i,a.bindInverse=new D(...i.inverseBindMatrices.data.slice(n*16,(n+1)*16)),a}),i.skeleton&&(i.skeleton=e[i.skeleton])})}static parseAnimations(t,e,i,s){return e.animations?e.animations.map(({channels:n,samplers:a,name:o},h)=>{let l=n.map(({sampler:c,target:f})=>{let{input:u,interpolation:p="LINEAR",output:d}=a[c],{node:x,path:m}=f,g=i[x],w=cn[m],y=this.parseAccessor(u,e,s).data,b=this.parseAccessor(d,e,s).data;return g.animations||(g.animations=[]),g.animations.includes(h)||g.animations.push(h),{node:g,transform:w,interpolation:p,times:y,values:b}});return{name:o,animation:new bt(l)}}):null}static parseScenes(t,e){return t.scenes?t.scenes.map(({nodes:i=[],name:s,extensions:n,extras:a})=>{let o=i.reduce((h,l)=>(e[l]&&h.push(e[l]),h),[]);return o.extras=a,o}):null}static parseLights(t,e,i,s){var o,h;let n={directional:[],point:[],spot:[]};s.forEach(l=>l.forEach(c=>c.updateMatrixWorld()));let a=((h=(o=e.extensions)==null?void 0:o.KHR_lights_punctual)==null?void 0:h.lights)||[];return i.forEach(l=>{var p;if(!((p=l==null?void 0:l.extensions)!=null&&p.KHR_lights_punctual))return;let c=l.extensions.KHR_lights_punctual.light,f=a[c],u={name:f.name||"",color:{value:new M().set(f.color||1)}};switch(f.intensity!==void 0&&u.color.value.multiply(f.intensity),f.type){case"directional":u.direction={value:new M(0,0,1).transformDirection(l.worldMatrix)};break;case"point":u.position={value:new M().applyMatrix4(l.worldMatrix)},u.distance={value:f.range},u.decay={value:2};break;case"spot":Object.assign(u,f);break}n[f.type].push(u)}),n}};var Xe,Ye=0,He=class{constructor(t,e){Xe||(Xe=this.getSupportedFormat(e)),this.onMessage=this.onMessage.bind(this),this.queue=new Map,this.initWorker(t)}getSupportedFormat(t=document.createElement("canvas").getContext("webgl")){return t.getExtension("WEBGL_compressed_texture_astc")?"astc":t.getExtension("EXT_texture_compression_bptc")?"bptc":t.getExtension("WEBGL_compressed_texture_s3tc")?"s3tc":t.getExtension("WEBGL_compressed_texture_etc1")?"etc1":t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc")?"pvrtc":"none"}initWorker(t){this.worker=new Worker(t),this.worker.onmessage=this.onMessage}onMessage({data:t}){let{id:e,error:i,image:s}=t;if(i){console.log(i,e);return}let n=this.queue.get(e);this.queue.delete(e),s.isBasis=!0,n(s)}parseTexture(t){Ye++,this.worker.postMessage({id:Ye,buffer:t,supportedFormat:Xe});let e,i=new Promise(s=>e=s);return this.queue.set(Ye,e),i}};var Qe=class extends B{constructor(t,{geometry:e,wireColor:i=new ot(0,.75,.5),...s}={}){let n=new U(t,{vertex:un,fragment:pn,uniforms:{wireColor:{value:i}}}),a=e.attributes.position.data,o=[],h=new Set;function l(u){for(let p=0;p<u.length;p+=2)fn(u[p]*3,u[p+1]*3,a,h)&&o.push(u[p],u[p+1])}if(e.attributes.index){let u=e.attributes.index.data;for(let p=0;p<u.length;p+=3)l([u[p],u[p+1],u[p+1],u[p+2],u[p+2],u[p]])}else{let u=Math.floor(a.length/3);for(let p=0;p<u;p+=3)l([p,p+1,p+1,p+2,p+2,p])}let c=o.length>65536?new Uint32Array(o):new Uint16Array(o),f=new O(t,{position:{...e.attributes.position},index:{data:c}});super(t,{...s,mode:t.LINES,geometry:f,program:n})}};function fn(r,t,e,i){let s=[e[r],e[r+1],e[r+2],e[t],e[t+1],e[t+2]].join("#"),n=[e[t],e[t+1],e[t+2],e[r],e[r+1],e[r+2]].join("#"),a=i.size;return i.add(s),i.add(n),i.size-a===2}var un="\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main() {    \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",pn="\nprecision highp float;\nuniform vec3 wireColor;\n\nvoid main() {    \n    gl_FragColor = vec4(wireColor, 1.0);\n}\n";var Ke=class extends B{constructor(t,{size:e=1,symmetric:i=!1,xColor:s=new M(.96,.21,.32),yColor:n=new M(.44,.64,.11),zColor:a=new M(.18,.52,.89),...o}={}){let h=i?-e:0,l=e,c=new Float32Array([h,0,0,l,0,0,0,h,0,0,l,0,0,0,h,0,0,l]),f=new Float32Array([...s,...s,...n,...n,...a,...a]),u=new O(t,{position:{size:3,data:c},color:{size:3,data:f}}),p=new U(t,{vertex:dn,fragment:mn});super(t,{...o,mode:t.LINES,geometry:u,program:p})}},dn="\nattribute vec3 position;\nattribute vec3 color;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec3 vColor;\n\nvoid main() {    \n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",mn="\nprecision highp float;\nvarying vec3 vColor;\n\nvoid main() {    \n    gl_FragColor = vec4(vColor, 1.0);\n}\n";var Ze=class extends B{constructor(t,{size:e=10,divisions:i=10,color:s=new M(.75,.75,.75),...n}={}){let a=(e+1)*2*2,o=new Float32Array(a*3),h=e/2;for(let f=0;f<=i;f++){let p=f/i*e-h;o.set([p,0,-h,p,0,h],f*12),o.set([-h,0,p,h,0,p],f*12+6)}let l=new O(t,{position:{size:3,data:o}}),c=new U(t,{vertex:gn,fragment:xn,uniforms:{color:{value:s}}});super(t,{...n,mode:t.LINES,geometry:l,program:c})}},gn="\nattribute vec3 position;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main() {    \n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",xn="\nprecision highp float;\nuniform vec3 color;\n\nvoid main() {    \n    gl_FragColor = vec4(color, 1.0);\n}\n";var $e=class extends B{constructor(t,{size:e=.1,color:i=new M(.86,.16,.86),...s}={}){let n=t.gl,a=t.geometry.attributes.normal.count,o=new Float32Array(a*2*3),h=new Float32Array(a*2*3),l=new Float32Array(a*2),c=t.geometry.attributes.normal.data,f=t.geometry.attributes.position.data,u=new Float32Array([0,e]);for(let x=0;x<a;x++){let m=x*6,g=x*3,w=f.subarray(g,g+3);o.set(w,m),o.set(w,m+3);let y=c.subarray(g,g+3);h.set(y,m),h.set(y,m+3),l.set(u,x*2)}let p=new O(n,{position:{size:3,data:o},normal:{size:3,data:h},size:{size:1,data:l}}),d=new U(n,{vertex:yn,fragment:wn,uniforms:{color:{value:i},worldNormalMatrix:{value:new et},objectWorldMatrix:{value:t.worldMatrix}}});super(n,{...s,mode:n.LINES,geometry:p,program:d}),this.object=t}draw(t){this.program.uniforms.worldNormalMatrix.value.getNormalMatrix(this.object.worldMatrix),super.draw(t)}},yn="\nattribute vec3 position;\nattribute vec3 normal;\nattribute float size;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 objectWorldMatrix;\nuniform mat3 worldNormalMatrix;\n\nvoid main() {\n    vec3 n = normalize(worldNormalMatrix * normal) * size;\n    vec3 p = (objectWorldMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = projectionMatrix * viewMatrix * vec4(p + n, 1.0);\n}\n",wn="\nprecision highp float;\nuniform vec3 color;\n\nvoid main() {    \n    gl_FragColor = vec4(color, 1.0);\n}\n";var _t=new M,Wt=new M,Rt=new M,Je=new M,tr=new M,er=class extends B{constructor(t,{size:e=.1,color:i=new M(.15,.86,.86),...s}={}){let n=t.gl,a=t.geometry.attributes.position.data,o=new Float32Array([0,e]),h=t.geometry.attributes.index,l=h?g=>h.data[g]:g=>g,c=h?h.data.length:Math.floor(a.length/3),f=Math.floor(c/3),u=new Float32Array(f*2*3),p=new Float32Array(f*2*3),d=new Float32Array(f*2);for(let g=0;g<c;g+=3){_t.fromArray(a,l(g+0)*3),Wt.fromArray(a,l(g+1)*3),Rt.fromArray(a,l(g+2)*3),Je.add(_t,Wt).add(Rt).multiply(1/3),_t.sub(_t,Wt),Rt.sub(Rt,Wt),tr.cross(Rt,_t).normalize();let w=g*2;u.set(Je,w),u.set(Je,w+3),p.set(tr,w),p.set(tr,w+3),d.set(o,g/3*2)}let x=new O(n,{position:{size:3,data:u},normal:{size:3,data:p},size:{size:1,data:d}}),m=new U(n,{vertex:Mn,fragment:En,uniforms:{color:{value:i},worldNormalMatrix:{value:new et},objectWorldMatrix:{value:t.worldMatrix}}});super(n,{...s,mode:n.LINES,geometry:x,program:m}),this.object=t}draw(t){this.program.uniforms.worldNormalMatrix.value.getNormalMatrix(this.object.worldMatrix),super.draw(t)}},Mn="\nattribute vec3 position;\nattribute vec3 normal;\nattribute float size;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 objectWorldMatrix;\nuniform mat3 worldNormalMatrix;\n\nvoid main() {\n    vec3 n = normalize(worldNormalMatrix * normal) * size;\n    vec3 p = (objectWorldMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = projectionMatrix * viewMatrix * vec4(p + n, 1.0);\n}\n",En="\nprecision highp float;\nuniform vec3 color;\n\nvoid main() {    \n    gl_FragColor = vec4(color, 1.0);\n}\n";export{Et as Animation,Ke as AxesHelper,He as BasisManager,me as Box,gt as Camera,ot as Color,ut as Curve,xe as Cylinder,mt as Euler,er as FaceNormalsHelper,Ve as Flowmap,bt as GLTFAnimation,je as GLTFLoader,Ft as GLTFSkin,De as GPGPU,O as Geometry,Ze as GridHelper,Tt as InstancedMesh,At as KTXTexture,et as Mat3,D as Mat4,B as Mesh,Be as NormalProgram,Ts as Orbit,Le as Path,tt as Plane,Ue as Polyline,Pe as Post,U as Program,K as Quat,Ee as Raycast,Y as RenderTarget,re as Renderer,qe as Shadow,Oe as Skin,ge as Sphere,Gs as Text,q as Texture,We as TextureLoader,ye as Torus,H as Transform,rt as Triangle,Se as Tube,k as Vec2,M as Vec3,xt as Vec4,$e as VertexNormalsHelper,Qe as WireMesh};
